<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gemforce Team" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>IERC734 - Gemforce Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "IERC734";
        var mkdocs_page_input_path = "smart-contracts/interfaces/ierc734.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Gemforce Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../developer-setup-guide/">Developer Setup Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../system-architecture/gemforce-system-architecture/">System Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Contracts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../diamond/">Diamond Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Facets</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/marketplace-facet/">Marketplace Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-management-facet/">Trade Deal Management Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/carbon-credit-facet/">Carbon Credit Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/identity-registry-facet/">Identity Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trusted-issuers-registry-facet/">Trusted Issuers Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/fee-distributor-facet/">Fee Distributor Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/gemforce-minter-facet/">Gemforce Minter Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/multi-sale-facet/">Multi Sale Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/svg-templates-facet/">SVG Templates Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-admin-facet/">Trade Deal Admin Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-operations-facet/">Trade Deal Operations Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/collateral-token-factory-facet/">Collateral Token Factory Facet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Interfaces</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../idiamond/">IDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../imarketplace/">IMarketplace</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../itradedeal/">ITradeDeal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../icarbon-credit/">ICarbonCredit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ierc1155-mint/">IERC1155Mint</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">IERC734</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-features">Key Features</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#interface-definition">Interface Definition</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-purpose-constants">Key Purpose Constants</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-type-constants">Key Type Constants</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#core-functions">Core Functions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#key-management">Key Management</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#execution-management">Execution Management</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#query-functions">Query Functions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#key-information">Key Information</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#execution-information">Execution Information</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-examples">Integration Examples</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#multi-signature-identity-wallet">Multi-Signature Identity Wallet</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#identity-based-access-control">Identity-Based Access Control</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#decentralized-identity-provider">Decentralized Identity Provider</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#events">Events</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#key-management-events">Key Management Events</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#execution-management-events">Execution Management Events</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#security-considerations">Security Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#key-management-security">Key Management Security</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#access-control">Access Control</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#multi-signature-security">Multi-Signature Security</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gas-optimization">Gas Optimization</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#efficient-operations">Efficient Operations</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#storage-optimization">Storage Optimization</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#common-errors">Common Errors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-considerations">Testing Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit Tests</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#integration-tests">Integration Tests</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ierc735/">IERC735</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Libraries</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/carbon-credit-lib/">Carbon Credit Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/trade-deal-lib/">Trade Deal Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/multi-sale-lib/">Multi Sale Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/diamond-factory-lib/">Diamond Factory Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/svg-templates-lib/">SVG Templates Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/attribute-lib/">Attribute Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/variable-price-lib/">Variable Price Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/merkle-prover/">Merkle Prover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/fee-distributor-lib/">Fee Distributor Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/lib-diamond/">LibDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/diamond-lib/">DiamondLib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/erc721a-lib/">ERC721A Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/erc721a-enumeration-lib/">ERC721A Enumeration Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/strings-lib/">Strings Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/metadata-lib/">Metadata Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/trusted-issuer-lib/">Trusted Issuer Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../libraries/set-libraries/">Set Libraries</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Functions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/blockchain/">Blockchain Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/dfns/">DFNS Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/contracts/">Contract Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/authentication/">Authentication Functions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-documentation/">Full API Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-quick-reference/">Quick Reference</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">EIPs (Ethereum Improvement Proposals)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Enhanced-Marketplace/">Diamond-Enhanced Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Multi-Token-Sale-Standard/">Multi-Token Sale Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Collateralized-Trade-Deal-Standard/">Collateralized Trade Deal Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Enhanced-Identity-System/">Enhanced Identity System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Factory-Standard/">Diamond Factory Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Carbon-Credit-Standard/">Carbon Credit Standard</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-administrator-guide/">Administrator Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-deployer-guide/">Deployer Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-integrator-guide/">Integrator Guide</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../external-services/gemforce-external-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-documentation-gap-analysis/">Documentation Gap Analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-progress-summary/">Documentation Progress Summary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-plan/">Documentation Plan</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Gemforce Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Smart Contracts</li>
          <li class="breadcrumb-item">Interfaces</li>
      <li class="breadcrumb-item active">IERC734</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ierc734-interface">IERC734 Interface<a class="headerlink" href="#ierc734-interface" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <a href="../../../contracts/interfaces/IERC734.sol"><code>IERC734</code></a> interface defines the Key Manager standard for decentralized identity management within the Gemforce platform. This interface implements the ERC-734 standard for managing cryptographic keys associated with identity contracts, enabling multi-signature operations, role-based access control, and secure execution of transactions through key-based authorization.</p>
<h2 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Multi-Key Management</strong>: Support for multiple cryptographic keys with different purposes</li>
<li><strong>Purpose-Based Authorization</strong>: Keys can be assigned specific purposes (management, action, claim, encryption)</li>
<li><strong>Key Type Support</strong>: Different cryptographic key types (ECDSA, RSA, etc.)</li>
<li><strong>Execution Management</strong>: Secure transaction execution with multi-signature approval</li>
<li><strong>Event Tracking</strong>: Comprehensive event emission for key and execution operations</li>
</ul>
<h2 id="interface-definition">Interface Definition<a class="headerlink" href="#interface-definition" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span>

<span class="kt">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>IERC165<span class="w"> </span><span class="p">}</span><span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;./IERC165.sol&quot;</span><span class="p">;</span>

interface<span class="w"> </span>IERC734<span class="w"> </span><span class="kt">is</span><span class="w"> </span>IERC165<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Events</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">KeyAdded</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>key<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>purpose<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>keyType<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">KeyRemoved</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>key<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>purpose<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>keyType<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ExecutionRequested</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Executed</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ExecutionFailed</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Approved</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approved</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Key Management Functions</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">addKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_keyType</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">approve</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_id</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">_approve</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Query Functions</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">key</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getKeyPurposes</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getKeysByPurpose</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getExecution</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_id</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approved</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">executionType</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="key-purpose-constants">Key Purpose Constants<a class="headerlink" href="#key-purpose-constants" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// Standard key purposes as defined in ERC-734</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>MANAGEMENT_KEY<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w">    </span><span class="c1">// Can manage the identity</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>ACTION_KEY<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w">        </span><span class="c1">// Can perform actions</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>CLAIM_SIGNER_KEY<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w">  </span><span class="c1">// Can sign claims</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>ENCRYPTION_KEY<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">;</span><span class="w">    </span><span class="c1">// Can encrypt/decrypt data</span>
</code></pre></div>

<h2 id="key-type-constants">Key Type Constants<a class="headerlink" href="#key-type-constants" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// Standard key types</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>ECDSA_TYPE<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w">        </span><span class="c1">// ECDSA key type</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>RSA_TYPE<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w">          </span><span class="c1">// RSA key type</span>
<span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">constant</span><span class="w"> </span>MULTISIG_TYPE<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w">     </span><span class="c1">// Multi-signature key type</span>
</code></pre></div>

<h2 id="core-functions">Core Functions<a class="headerlink" href="#core-functions" title="Permanent link">&para;</a></h2>
<h3 id="key-management">Key Management<a class="headerlink" href="#key-management" title="Permanent link">&para;</a></h3>
<h4 id="addkey"><code>addKey()</code><a class="headerlink" href="#addkey" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">addKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_keyType</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span>
</code></pre></div>

<p><strong>Purpose</strong>: Add a new key to the identity with specified purpose and type.</p>
<p><strong>Parameters</strong>:
- <code>_key</code> (bytes32): The key identifier (typically keccak256 hash of the public key)
- <code>_purpose</code> (uint256): The purpose of the key (MANAGEMENT_KEY, ACTION_KEY, etc.)
- <code>_keyType</code> (uint256): The cryptographic type of the key (ECDSA_TYPE, RSA_TYPE, etc.)</p>
<p><strong>Requirements</strong>:
- Caller must have MANAGEMENT_KEY purpose
- Key must not already exist with the same purpose
- Purpose and key type must be valid</p>
<p><strong>Events Emitted</strong>:
- <a href="ierc734.md:8"><code>KeyAdded</code></a> with key, purpose, and key type</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Add a new action key for transaction execution</span>
<span class="kt">bytes32</span><span class="w"> </span><span class="nv">newKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>publicKey<span class="p">));</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">purpose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ACTION_KEY<span class="p">;</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ECDSA_TYPE<span class="p">;</span>

IERC734<span class="p">(</span>identityContract<span class="p">).</span>addKey<span class="p">(</span>newKey<span class="p">,</span><span class="w"> </span>purpose<span class="p">,</span><span class="w"> </span>keyType<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Added action key:&quot;</span><span class="p">,</span><span class="w"> </span>newKey<span class="p">);</span>
</code></pre></div>

<h4 id="removekey"><code>removeKey()</code><a class="headerlink" href="#removekey" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">removeKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span>
</code></pre></div>

<p><strong>Purpose</strong>: Remove a key from the identity for a specific purpose.</p>
<p><strong>Parameters</strong>:
- <code>_key</code> (bytes32): The key identifier to remove
- <code>_purpose</code> (uint256): The purpose for which to remove the key</p>
<p><strong>Requirements</strong>:
- Caller must have MANAGEMENT_KEY purpose
- Key must exist with the specified purpose
- Cannot remove the last management key</p>
<p><strong>Events Emitted</strong>:
- <a href="ierc734.md:9"><code>KeyRemoved</code></a> with key, purpose, and key type</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Remove an action key</span>
<span class="kt">bytes32</span><span class="w"> </span><span class="nv">keyToRemove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234567890abcdef</span><span class="p">...;</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">purpose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ACTION_KEY<span class="p">;</span>

IERC734<span class="p">(</span>identityContract<span class="p">).</span>removeKey<span class="p">(</span>keyToRemove<span class="p">,</span><span class="w"> </span>purpose<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Removed key:&quot;</span><span class="p">,</span><span class="w"> </span>keyToRemove<span class="p">,</span><span class="w"> </span><span class="s2">&quot;for purpose:&quot;</span><span class="p">,</span><span class="w"> </span>purpose<span class="p">);</span>
</code></pre></div>

<h3 id="execution-management">Execution Management<a class="headerlink" href="#execution-management" title="Permanent link">&para;</a></h3>
<h4 id="approve"><code>approve()</code><a class="headerlink" href="#approve" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">approve</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_id</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">_approve</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span>
</code></pre></div>

<p><strong>Purpose</strong>: Approve or reject a pending execution request.</p>
<p><strong>Parameters</strong>:
- <code>_id</code> (uint256): The execution ID to approve or reject
- <code>_approve</code> (bool): True to approve, false to reject</p>
<p><strong>Requirements</strong>:
- Caller must have appropriate key purpose for the execution
- Execution must exist and be pending
- Caller must not have already voted on this execution</p>
<p><strong>Events Emitted</strong>:
- <a href="ierc734.md:18"><code>Approved</code></a> with execution ID and approval status
- <a href="ierc734.md:16"><code>Executed</code></a> if execution is approved and executed successfully
- <a href="ierc734.md:17"><code>ExecutionFailed</code></a> if execution is approved but fails</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Approve a pending execution</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">executionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="nv">approve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>

IERC734<span class="p">(</span>identityContract<span class="p">).</span>approve<span class="p">(</span>executionId<span class="p">,</span><span class="w"> </span>approve<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Approved execution:&quot;</span><span class="p">,</span><span class="w"> </span>executionId<span class="p">);</span>
</code></pre></div>

<h2 id="query-functions">Query Functions<a class="headerlink" href="#query-functions" title="Permanent link">&para;</a></h2>
<h3 id="key-information">Key Information<a class="headerlink" href="#key-information" title="Permanent link">&para;</a></h3>
<h4 id="getkey"><code>getKey()</code><a class="headerlink" href="#getkey" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">getKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Get detailed information about a specific key.</p>
<p><strong>Parameters</strong>:
- <code>_key</code> (bytes32): The key identifier to query</p>
<p><strong>Returns</strong>:
- <code>purposes</code> (uint256[]): Array of purposes assigned to this key
- <code>keyType</code> (uint256): The cryptographic type of the key
- <code>key</code> (bytes32): The key identifier (same as input)</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get key information</span>
<span class="kt">bytes32</span><span class="w"> </span><span class="nv">keyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234567890abcdef</span><span class="p">...;</span>
<span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>identityContract<span class="p">).</span>getKey<span class="p">(</span>keyId<span class="p">);</span>

console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Key purposes:&quot;</span><span class="p">,</span><span class="w"> </span>purposes<span class="p">.</span>length<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Key type:&quot;</span><span class="p">,</span><span class="w"> </span>keyType<span class="p">);</span>
</code></pre></div>

<h4 id="getkeypurposes"><code>getKeyPurposes()</code><a class="headerlink" href="#getkeypurposes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">getKeyPurposes</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">_key</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Get all purposes assigned to a specific key.</p>
<p><strong>Parameters</strong>:
- <code>_key</code> (bytes32): The key identifier to query</p>
<p><strong>Returns</strong>: Array of purposes assigned to the key</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get key purposes</span>
<span class="kt">bytes32</span><span class="w"> </span><span class="nv">keyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234567890abcdef</span><span class="p">...;</span>
<span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>identityContract<span class="p">).</span>getKeyPurposes<span class="p">(</span>keyId<span class="p">);</span>

<span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>purposes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Purpose:&quot;</span><span class="p">,</span><span class="w"> </span>purposes<span class="p">[</span>i<span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="getkeysbypurpose"><code>getKeysByPurpose()</code><a class="headerlink" href="#getkeysbypurpose" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">getKeysByPurpose</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_purpose</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Get all keys assigned to a specific purpose.</p>
<p><strong>Parameters</strong>:
- <code>_purpose</code> (uint256): The purpose to query keys for</p>
<p><strong>Returns</strong>: Array of key identifiers with the specified purpose</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get all management keys</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">purpose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>MANAGEMENT_KEY<span class="p">;</span>
<span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>managementKeys<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>identityContract<span class="p">).</span>getKeysByPurpose<span class="p">(</span>purpose<span class="p">);</span>

console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Management keys count:&quot;</span><span class="p">,</span><span class="w"> </span>managementKeys<span class="p">.</span>length<span class="p">);</span>
<span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>managementKeys<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Management key:&quot;</span><span class="p">,</span><span class="w"> </span>managementKeys<span class="p">[</span>i<span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="execution-information">Execution Information<a class="headerlink" href="#execution-information" title="Permanent link">&para;</a></h3>
<h4 id="getexecution"><code>getExecution()</code><a class="headerlink" href="#getexecution" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">getExecution</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_id</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approved</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">executionType</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Get detailed information about a specific execution request.</p>
<p><strong>Parameters</strong>:
- <code>_id</code> (uint256): The execution ID to query</p>
<p><strong>Returns</strong>:
- <code>to</code> (address): The target address for the execution
- <code>value</code> (uint256): The ETH value to send with the execution
- <code>data</code> (bytes): The call data for the execution
- <code>approved</code> (bool): Whether the execution has been approved
- <code>executionType</code> (uint256): The type of execution</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get execution details</span>
<span class="kt">uint256</span><span class="w"> </span><span class="nv">executionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="p">(</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approved</span><span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">executionType</span>
<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>identityContract<span class="p">).</span>getExecution<span class="p">(</span>executionId<span class="p">);</span>

console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Execution target:&quot;</span><span class="p">,</span><span class="w"> </span>to<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Execution value:&quot;</span><span class="p">,</span><span class="w"> </span>value<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Execution approved:&quot;</span><span class="p">,</span><span class="w"> </span>approved<span class="p">);</span>
</code></pre></div>

<h2 id="integration-examples">Integration Examples<a class="headerlink" href="#integration-examples" title="Permanent link">&para;</a></h2>
<h3 id="multi-signature-identity-wallet">Multi-Signature Identity Wallet<a class="headerlink" href="#multi-signature-identity-wallet" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Multi-signature wallet using ERC-734 key management</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">MultiSigIdentityWallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>IERC734<span class="w"> </span><span class="kt">public</span><span class="w"> </span>keyManager<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Transaction</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">executed</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">confirmations</span><span class="p">;</span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>isConfirmed<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Transaction<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>transactions<span class="p">;</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">transactionCount</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">required</span><span class="p">;</span><span class="w"> </span><span class="c1">// Required confirmations</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">TransactionSubmitted</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>transactionId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">TransactionConfirmed</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>transactionId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>confirmer<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">TransactionExecuted</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>transactionId<span class="p">);</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_keyManager</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_required</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>keyManager<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>_keyManager<span class="p">);</span>
<span class="w">        </span>required<span class="w"> </span><span class="o">=</span><span class="w"> </span>_required<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">submitTransaction</span><span class="p">(</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyActionKey<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">transactionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>transactionId<span class="w"> </span><span class="o">=</span><span class="w"> </span>transactionCount<span class="o">++</span><span class="p">;</span>

<span class="w">        </span>Transaction<span class="w"> </span>storage<span class="w"> </span>txn<span class="w"> </span><span class="o">=</span><span class="w"> </span>transactions<span class="p">[</span>transactionId<span class="p">];</span>
<span class="w">        </span>txn<span class="p">.</span>to<span class="w"> </span><span class="o">=</span><span class="w"> </span>to<span class="p">;</span>
<span class="w">        </span>txn<span class="p">.</span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span>
<span class="w">        </span>txn<span class="p">.</span>data<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">;</span>
<span class="w">        </span>txn<span class="p">.</span>executed<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span>txn<span class="p">.</span>confirmations<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>TransactionSubmitted<span class="p">(</span>transactionId<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>value<span class="p">);</span>

<span class="w">        </span><span class="c1">// Auto-confirm from submitter</span>
<span class="w">        </span>confirmTransaction<span class="p">(</span>transactionId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">confirmTransaction</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">transactionId</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyActionKey<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Transaction<span class="w"> </span>storage<span class="w"> </span>txn<span class="w"> </span><span class="o">=</span><span class="w"> </span>transactions<span class="p">[</span>transactionId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>txn<span class="p">.</span>executed<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Transaction already executed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>txn<span class="p">.</span>isConfirmed<span class="p">[</span><span class="k">msg.sender</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;Transaction already confirmed by sender&quot;</span><span class="p">);</span>

<span class="w">        </span>txn<span class="p">.</span>isConfirmed<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span>txn<span class="p">.</span>confirmations<span class="o">++</span><span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>TransactionConfirmed<span class="p">(</span>transactionId<span class="p">,</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>txn<span class="p">.</span>confirmations<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>required<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>executeTransaction<span class="p">(</span>transactionId<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">executeTransaction</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">transactionId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Transaction<span class="w"> </span>storage<span class="w"> </span>txn<span class="w"> </span><span class="o">=</span><span class="w"> </span>transactions<span class="p">[</span>transactionId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>txn<span class="p">.</span>executed<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Transaction already executed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>txn<span class="p">.</span>confirmations<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>required<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Insufficient confirmations&quot;</span><span class="p">);</span>

<span class="w">        </span>txn<span class="p">.</span>executed<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>

<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>to<span class="p">.</span>call<span class="p">{</span>value<span class="o">:</span><span class="w"> </span>txn<span class="p">.</span>value<span class="p">}(</span>txn<span class="p">.</span>data<span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Transaction execution failed&quot;</span><span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>TransactionExecuted<span class="p">(</span>transactionId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getTransactionInfo</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">transactionId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">executed</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">confirmations</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">canExecute</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Transaction<span class="w"> </span>storage<span class="w"> </span>txn<span class="w"> </span><span class="o">=</span><span class="w"> </span>transactions<span class="p">[</span>transactionId<span class="p">];</span>
<span class="w">        </span>to<span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>to<span class="p">;</span>
<span class="w">        </span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>value<span class="p">;</span>
<span class="w">        </span>data<span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>data<span class="p">;</span>
<span class="w">        </span>executed<span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>executed<span class="p">;</span>
<span class="w">        </span>confirmations<span class="w"> </span><span class="o">=</span><span class="w"> </span>txn<span class="p">.</span>confirmations<span class="p">;</span>
<span class="w">        </span>canExecute<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span>executed<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>confirmations<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>required<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyActionKey<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">senderKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="k">msg.sender</span><span class="p">));</span>
<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="w"> </span><span class="o">=</span><span class="w"> </span>keyManager<span class="p">.</span>getKeyPurposes<span class="p">(</span>senderKey<span class="p">);</span>

<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">hasActionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>purposes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>purposes<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ACTION_KEY</span>
<span class="w">                </span>hasActionKey<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">                </span><span class="kt">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>hasActionKey<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Sender does not have action key&quot;</span><span class="p">);</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="identity-based-access-control">Identity-Based Access Control<a class="headerlink" href="#identity-based-access-control" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Access control system using ERC-734 identity management</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">IdentityAccessControl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>IERC734<span class="w"> </span><span class="kt">public</span><span class="w"> </span>identityRegistry<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">AccessPolicy</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">requiredPurpose</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minKeyType</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">active</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">description</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>AccessPolicy<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>accessPolicies<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>userIdentities<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>authorizedIdentities<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AccessPolicyCreated</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">requiredPurpose</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">description</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">IdentityAuthorized</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>identityId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>user<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AccessGranted</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>user<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>policyId<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AccessDenied</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>user<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">reason</span><span class="p">);</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_identityRegistry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>identityRegistry<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>_identityRegistry<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createAccessPolicy</span><span class="p">(</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">policyId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">requiredPurpose</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minKeyType</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>description
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyAdmin<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>accessPolicies<span class="p">[</span>policyId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AccessPolicy<span class="p">({</span>
<span class="w">            </span>requiredPurpose<span class="o">:</span><span class="w"> </span>requiredPurpose<span class="p">,</span>
<span class="w">            </span>minKeyType<span class="o">:</span><span class="w"> </span>minKeyType<span class="p">,</span>
<span class="w">            </span>active<span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">            </span>description<span class="o">:</span><span class="w"> </span>description
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>emit<span class="w"> </span>AccessPolicyCreated<span class="p">(</span>policyId<span class="p">,</span><span class="w"> </span>requiredPurpose<span class="p">,</span><span class="w"> </span>description<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">authorizeIdentity</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">identityId</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">user</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyAdmin<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>authorizedIdentities<span class="p">[</span>identityId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span>userIdentities<span class="p">[</span>user<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>identityId<span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>IdentityAuthorized<span class="p">(</span>identityId<span class="p">,</span><span class="w"> </span>user<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">checkAccess</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">user</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">policyId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>AccessPolicy<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>policy<span class="w"> </span><span class="o">=</span><span class="w"> </span>accessPolicies<span class="p">[</span>policyId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>policy<span class="p">.</span>active<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Access policy not active&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">identityId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>userIdentities<span class="p">[</span>user<span class="p">];</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>identityId<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>emit<span class="w"> </span>AccessDenied<span class="p">(</span>user<span class="p">,</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;No identity registered&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>authorizedIdentities<span class="p">[</span>identityId<span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>emit<span class="w"> </span>AccessDenied<span class="p">(</span>user<span class="p">,</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Identity not authorized&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Check if user has required key purpose</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">userKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>user<span class="p">));</span>
<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>purposes<span class="w"> </span><span class="o">=</span><span class="w"> </span>identityRegistry<span class="p">.</span>getKeyPurposes<span class="p">(</span>userKey<span class="p">);</span>

<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">hasPurpose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>purposes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>purposes<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>policy<span class="p">.</span>requiredPurpose<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>hasPurpose<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">                </span><span class="kt">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>hasPurpose<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>emit<span class="w"> </span>AccessDenied<span class="p">(</span>user<span class="p">,</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Insufficient key purpose&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Check key type if specified</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>policy<span class="p">.</span>minKeyType<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">(,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>identityRegistry<span class="p">.</span>getKey<span class="p">(</span>userKey<span class="p">);</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>keyType<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>policy<span class="p">.</span>minKeyType<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>emit<span class="w"> </span>AccessDenied<span class="p">(</span>user<span class="p">,</span><span class="w"> </span>policyId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Insufficient key type&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>emit<span class="w"> </span>AccessGranted<span class="p">(</span>user<span class="p">,</span><span class="w"> </span>policyId<span class="p">);</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getUserIdentityInfo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">user</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">identityId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">authorized</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>keyPurposes<span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyType</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>identityId<span class="w"> </span><span class="o">=</span><span class="w"> </span>userIdentities<span class="p">[</span>user<span class="p">];</span>
<span class="w">        </span>authorized<span class="w"> </span><span class="o">=</span><span class="w"> </span>authorizedIdentities<span class="p">[</span>identityId<span class="p">];</span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>identityId<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">userKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>user<span class="p">));</span>
<span class="w">            </span>keyPurposes<span class="w"> </span><span class="o">=</span><span class="w"> </span>identityRegistry<span class="p">.</span>getKeyPurposes<span class="p">(</span>userKey<span class="p">);</span>
<span class="w">            </span><span class="p">(,</span><span class="w"> </span>keyType<span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>identityRegistry<span class="p">.</span>getKey<span class="p">(</span>userKey<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyAdmin<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check for admin role</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="decentralized-identity-provider">Decentralized Identity Provider<a class="headerlink" href="#decentralized-identity-provider" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Identity provider service using ERC-734</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">DecentralizedIdentityProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>IERC734<span class="w"> </span><span class="kt">public</span><span class="w"> </span>keyManager<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">IdentityProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">email</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">organization</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">createdAt</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">lastUpdated</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">verified</span><span class="p">;</span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span>attributes<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>IdentityProfile<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>profiles<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>keyToIdentity<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>identityKeys<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">IdentityCreated</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>identity<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">IdentityUpdated</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>identity<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">IdentityVerified</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>identity<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>verifier<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">KeyLinked</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>identity<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>key<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">purpose</span><span class="p">);</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_keyManager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>keyManager<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC734<span class="p">(</span>_keyManager<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createIdentity</span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>name<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>email<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>organization
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>createdAt<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Identity already exists&quot;</span><span class="p">);</span>

<span class="w">        </span>IdentityProfile<span class="w"> </span>storage<span class="w"> </span>profile<span class="w"> </span><span class="o">=</span><span class="w"> </span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span>
<span class="w">        </span>profile<span class="p">.</span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span>name<span class="p">;</span>
<span class="w">        </span>profile<span class="p">.</span>email<span class="w"> </span><span class="o">=</span><span class="w"> </span>email<span class="p">;</span>
<span class="w">        </span>profile<span class="p">.</span>organization<span class="w"> </span><span class="o">=</span><span class="w"> </span>organization<span class="p">;</span>
<span class="w">        </span>profile<span class="p">.</span>createdAt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>
<span class="w">        </span>profile<span class="p">.</span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>
<span class="w">        </span>profile<span class="p">.</span>verified<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Link primary key</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">primaryKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="k">msg.sender</span><span class="p">));</span>
<span class="w">        </span>keyToIdentity<span class="p">[</span>primaryKey<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span>identityKeys<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>push<span class="p">(</span>primaryKey<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>IdentityCreated<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>name<span class="p">);</span>
<span class="w">        </span>emit<span class="w"> </span>KeyLinked<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>primaryKey<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// MANAGEMENT_KEY</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">updateAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>attribute<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>createdAt<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Identity does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>attributes<span class="p">[</span>attribute<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span>
<span class="w">        </span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>IdentityUpdated<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>attribute<span class="p">,</span><span class="w"> </span>value<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">linkKey</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">purpose</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>profiles<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>createdAt<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Identity does not exist&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>keyToIdentity<span class="p">[</span>key<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Key already linked&quot;</span><span class="p">);</span>

<span class="w">        </span>keyToIdentity<span class="p">[</span>key<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span>identityKeys<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>push<span class="p">(</span>key<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>KeyLinked<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>key<span class="p">,</span><span class="w"> </span>purpose<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">verifyIdentity</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">identity</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyVerifier<span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>profiles<span class="p">[</span>identity<span class="p">].</span>createdAt<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Identity does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>profiles<span class="p">[</span>identity<span class="p">].</span>verified<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span>profiles<span class="p">[</span>identity<span class="p">].</span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>IdentityVerified<span class="p">(</span>identity<span class="p">,</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getIdentityProfile</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">identity</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>name<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>email<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>organization<span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">createdAt</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">lastUpdated</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">verified</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keyCount</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>IdentityProfile<span class="w"> </span>storage<span class="w"> </span>profile<span class="w"> </span><span class="o">=</span><span class="w"> </span>profiles<span class="p">[</span>identity<span class="p">];</span>
<span class="w">        </span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>name<span class="p">;</span>
<span class="w">        </span>email<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>email<span class="p">;</span>
<span class="w">        </span>organization<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>organization<span class="p">;</span>
<span class="w">        </span>createdAt<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>createdAt<span class="p">;</span>
<span class="w">        </span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>lastUpdated<span class="p">;</span>
<span class="w">        </span>verified<span class="w"> </span><span class="o">=</span><span class="w"> </span>profile<span class="p">.</span>verified<span class="p">;</span>
<span class="w">        </span>keyCount<span class="w"> </span><span class="o">=</span><span class="w"> </span>identityKeys<span class="p">[</span>identity<span class="p">].</span>length<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getAttribute</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">identity</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>attribute<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>profiles<span class="p">[</span>identity<span class="p">].</span>attributes<span class="p">[</span>attribute<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getIdentityKeys</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">identity</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>identityKeys<span class="p">[</span>identity<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">resolveKeyToIdentity</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>keyToIdentity<span class="p">[</span>key<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyVerifier<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check for verifier role</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<h3 id="key-management-events">Key Management Events<a class="headerlink" href="#key-management-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">event</span><span class="w"> </span><span class="nv">KeyAdded</span><span class="p">(</span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>key<span class="p">,</span><span class="w">        </span><span class="c1">// Key identifier</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>purpose<span class="p">,</span><span class="w">    </span><span class="c1">// Key purpose</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>keyType<span class="w">     </span><span class="c1">// Key type</span>
<span class="p">);</span>

<span class="kt">event</span><span class="w"> </span><span class="nv">KeyRemoved</span><span class="p">(</span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>key<span class="p">,</span><span class="w">        </span><span class="c1">// Key identifier</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>purpose<span class="p">,</span><span class="w">    </span><span class="c1">// Key purpose</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>keyType<span class="w">     </span><span class="c1">// Key type</span>
<span class="p">);</span>
</code></pre></div>

<h3 id="execution-management-events">Execution Management Events<a class="headerlink" href="#execution-management-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">event</span><span class="w"> </span><span class="nv">ExecutionRequested</span><span class="p">(</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w">    </span><span class="c1">// Execution identifier</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w">             </span><span class="c1">// Target address</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w">          </span><span class="c1">// ETH value</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="w">                      </span><span class="c1">// Call data</span>
<span class="p">);</span>

<span class="kt">event</span><span class="w"> </span><span class="nv">Executed</span><span class="p">(</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w">    </span><span class="c1">// Execution identifier</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w">             </span><span class="c1">// Target address</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w">          </span><span class="c1">// ETH value</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="w">                      </span><span class="c1">// Call data</span>
<span class="p">);</span>

<span class="kt">event</span><span class="w"> </span><span class="nv">ExecutionFailed</span><span class="p">(</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w">    </span><span class="c1">// Execution identifier</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w">             </span><span class="c1">// Target address</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>value<span class="p">,</span><span class="w">          </span><span class="c1">// ETH value</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="w">                      </span><span class="c1">// Call data</span>
<span class="p">);</span>

<span class="kt">event</span><span class="w"> </span><span class="nv">Approved</span><span class="p">(</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>executionId<span class="p">,</span><span class="w">    </span><span class="c1">// Execution identifier</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approved</span><span class="w">                   </span><span class="c1">// Approval status</span>
<span class="p">);</span>
</code></pre></div>

<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<h3 id="key-management-security">Key Management Security<a class="headerlink" href="#key-management-security" title="Permanent link">&para;</a></h3>
<ul>
<li>Secure key generation and storage</li>
<li>Prevention of key reuse across purposes</li>
<li>Protection against key compromise</li>
<li>Secure key rotation procedures</li>
</ul>
<h3 id="access-control">Access Control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h3>
<ul>
<li>Proper validation of key purposes and types</li>
<li>Prevention of unauthorized key additions/removals</li>
<li>Protection of management keys</li>
<li>Secure execution approval mechanisms</li>
</ul>
<h3 id="multi-signature-security">Multi-Signature Security<a class="headerlink" href="#multi-signature-security" title="Permanent link">&para;</a></h3>
<ul>
<li>Threshold signature validation</li>
<li>Prevention of replay attacks</li>
<li>Secure nonce management</li>
<li>Protection against front-running</li>
</ul>
<h2 id="gas-optimization">Gas Optimization<a class="headerlink" href="#gas-optimization" title="Permanent link">&para;</a></h2>
<h3 id="efficient-operations">Efficient Operations<a class="headerlink" href="#efficient-operations" title="Permanent link">&para;</a></h3>
<ul>
<li>Batch key operations where possible</li>
<li>Optimized storage layout for key data</li>
<li>Minimal external calls in view functions</li>
<li>Efficient event emission patterns</li>
</ul>
<h3 id="storage-optimization">Storage Optimization<a class="headerlink" href="#storage-optimization" title="Permanent link">&para;</a></h3>
<ul>
<li>Packed storage structures for key data</li>
<li>Efficient mapping usage for key lookups</li>
<li>Optimized array operations for key lists</li>
<li>Cached calculations for frequently accessed data</li>
</ul>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="common-errors">Common Errors<a class="headerlink" href="#common-errors" title="Permanent link">&para;</a></h3>
<ul>
<li>Unauthorized key management operations</li>
<li>Invalid key purposes or types</li>
<li>Non-existent keys or executions</li>
<li>Insufficient approvals for execution</li>
<li>Key already exists or doesn't exist</li>
</ul>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li>Validate caller permissions before operations</li>
<li>Check key existence before modifications</li>
<li>Verify execution requirements before approval</li>
<li>Handle edge cases gracefully</li>
<li>Provide clear error messages for debugging</li>
</ul>
<h2 id="testing-considerations">Testing Considerations<a class="headerlink" href="#testing-considerations" title="Permanent link">&para;</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Interface compliance verification</li>
<li>Key management function testing</li>
<li>Execution approval and execution testing</li>
<li>Event emission verification</li>
<li>Access control validation</li>
</ul>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Multi-signature workflow testing</li>
<li>Identity provider integration</li>
<li>Access control system integration</li>
<li>Cross-contract key validation</li>
<li>Security scenario testing</li>
</ul>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../ierc735/">IERC735</a> - Claim Holder interface for identity claims</li>
<li><a href="../../facets/identity-registry-facet/">IdentityRegistryFacet</a> - Identity registry implementation</li>
<li><a href="../../facets/trusted-issuers-registry-facet/">TrustedIssuersRegistryFacet</a> - Trusted issuer management</li>
<li><a href="../../guides/identity-system.md">Identity System Guide</a> - Implementation guide for identity management</li>
<li><a href="../../guides/multi-signature.md">Multi-Signature Guide</a> - Multi-signature implementation patterns</li>
</ul>
<hr />
<p><em>This interface defines the Key Manager standard (ERC-734) for decentralized identity management within the Gemforce platform, enabling secure multi-key management, role-based access control, and multi-signature transaction execution.</em></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ierc1155-mint/" class="btn btn-neutral float-left" title="IERC1155Mint"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ierc735/" class="btn btn-neutral float-right" title="IERC735">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ierc1155-mint/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ierc735/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
