<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gemforce Team" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>SVG Templates Lib - Gemforce Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "SVG Templates Lib";
        var mkdocs_page_input_path = "smart-contracts/libraries/svg-templates-lib.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Gemforce Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../developer-setup-guide/">Developer Setup Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../system-architecture/gemforce-system-architecture/">System Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Contracts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../diamond/">Diamond Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../diamond-factory/">Diamond Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../identity-factory/">Identity Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Facets</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/marketplace-facet/">Marketplace Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-management-facet/">Trade Deal Management Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/carbon-credit-facet/">Carbon Credit Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/identity-registry-facet/">Identity Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trusted-issuers-registry-facet/">Trusted Issuers Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/fee-distributor-facet/">Fee Distributor Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/gemforce-minter-facet/">Gemforce Minter Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/multi-sale-facet/">Multi Sale Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/svg-templates-facet/">SVG Templates Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-admin-facet/">Trade Deal Admin Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-operations-facet/">Trade Deal Operations Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/collateral-token-factory-facet/">Collateral Token Factory Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/diamond-cut-facet/">Diamond Cut Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/diamond-loupe-facet/">Diamond Loupe Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/ownership-facet/">Ownership Facet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Interfaces</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/idiamond/">IDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/imarketplace/">IMarketplace</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/itradedeal/">ITradeDeal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/icarbon-credit/">ICarbonCredit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc1155-mint/">IERC1155Mint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc734/">IERC734</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc735/">IERC735</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc721a/">IERC721A</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/idiamond-factory/">IDiamondFactory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iidentity/">IIdentity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/imultisale/">IMultiSale</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ifee-distributor/">IFeeDistributor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/igemforce-minter-facet/">IGemforceMinterFacet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iidentity-registry/">IIdentityRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/itrusted-issuers-registry/">TRUSTEDIssuersRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/isvg/">ISVG</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iattribute/">IAttribute</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Libraries</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../carbon-credit-lib/">Carbon Credit Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trade-deal-lib/">Trade Deal Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../multi-sale-lib/">Multi Sale Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../diamond-factory-lib/">Diamond Factory Lib</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">SVG Templates Lib</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-features">Key Features</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#library-definition">Library Definition</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-structures">Data Structures</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#svgtemplatescontract-struct">SVGTemplatesContract Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#saltstorage-struct">SaltStorage Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#multipartcontract-struct">MultiPartContract Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#svgstorage-struct">SVGStorage Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#replacement-struct">Replacement Struct</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#core-functions">Core Functions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#storage-management">Storage Management</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#template-management">Template Management</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#template-creation">Template Creation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-examples">Integration Examples</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#nft-avatar-system">NFT Avatar System</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#gaming-asset-renderer">Gaming Asset Renderer</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#certificate-generator">Certificate Generator</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#events">Events</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#svg-template-events">SVG Template Events</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#security-considerations">Security Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#template-deployment-security">Template Deployment Security</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#access-control">Access Control</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#content-validation">Content Validation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gas-optimization">Gas Optimization</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#storage-efficiency">Storage Efficiency</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#rendering-efficiency">Rendering Efficiency</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#common-errors">Common Errors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-considerations">Testing Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit Tests</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#integration-tests">Integration Tests</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../attribute-lib/">Attribute Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../variable-price-lib/">Variable Price Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../merkle-prover/">Merkle Prover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fee-distributor-lib/">Fee Distributor Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lib-diamond/">LibDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../diamond-lib/">DiamondLib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../erc721a-lib/">ERC721A Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../erc721a-enumeration-lib/">ERC721A Enumeration Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../strings-lib/">Strings Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trusted-issuer-lib/">Trusted Issuer Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../set-libraries/">Set Libraries</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SDK & Libraries</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/blockchain/">Blockchain Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/diamond/">Diamond Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/contract/">Contract Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/deploy/">Deployment Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/validation-utils/">Validation Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/nft-sale-utils/">NFT Sale Utilities</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Functions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/authentication/">Authentication Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/auth-functions/">Auth Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/blockchain/">Blockchain Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/bridge/">Bridge Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/contracts/">Contract Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/deploy/">Deploy Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/dfns/">DFNS Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/project/">Project Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/trade-deal/">Trade Deal Functions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-documentation/">Full API Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-quick-reference/">Quick Reference</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Operations Tasks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/diamond/">Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/identities/">Identity Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/marketplace-management/">Marketplace Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/carbon-credit-management/">Carbon Credit Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/trade-deal/">Trade Deal Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test/">Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test-marketplace/">Marketplace Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test-trade-deal/">Trade Deal Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/admin-utils/">Admin Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/sync-diamond/">Sync Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/sync-events/">Sync Events Tasks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">EIPs (Ethereum Improvement Proposals)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Enhanced-Marketplace/">Diamond-Enhanced Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Multi-Token-Sale-Standard/">Multi-Token Sale Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Collateralized-Trade-Deal-Standard/">Collateralized Trade Deal Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Enhanced-Identity-System/">Enhanced Identity System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Factory-Standard/">Diamond Factory Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Carbon-Credit-Standard/">Carbon Credit Standard</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-administrator-guide/">Administrator Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-deployer-guide/">Deployer Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-integrator-guide/">Integrator Guide</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Integrator's Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/rest-api/">REST API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/smart-contracts/">Smart Contracts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/dfns/">DFNS Integration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/webhooks/">Webhooks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/error-handling/">Error Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/sample-code/">Sample Code</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/integration-patterns/">Integration Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/security/">Security</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../external-services/gemforce-external-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-documentation-gap-analysis/">Documentation Gap Analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-progress-summary/">Documentation Progress Summary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-plan/">Documentation Plan</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Gemforce Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Smart Contracts</li>
          <li class="breadcrumb-item">Libraries</li>
      <li class="breadcrumb-item active">SVG Templates Lib</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="svgtemplateslib-library">SVGTemplatesLib Library<a class="headerlink" href="#svgtemplateslib-library" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <a href="../../../contracts/libraries/SVGTemplatesLib.sol"><code>SVGTemplatesLib</code></a> library provides core utilities for creating and managing on-chain SVG templates within the Gemforce platform. This library enables dynamic generation of SVG graphics for NFT metadata, supporting template-based rendering with variable substitution and multi-part composition.</p>
<h2 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>On-Chain SVG Storage</strong>: Store SVG templates directly on the blockchain</li>
<li><strong>Deterministic Deployment</strong>: CREATE2-based template contract deployment</li>
<li><strong>Template Management</strong>: Named template registry with unique addressing</li>
<li><strong>Dynamic Rendering</strong>: Variable substitution for customizable graphics</li>
<li><strong>Multi-Part Support</strong>: Composition of complex SVG graphics from components</li>
<li><strong>Ownership Transfer</strong>: Template ownership management for creators</li>
</ul>
<h2 id="library-definition">Library Definition<a class="headerlink" href="#library-definition" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.6</span><span class="p">;</span>

<span class="kt">library</span><span class="w"> </span>SVGTemplatesLib<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Storage management</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">svgStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>SVGStorage<span class="w"> </span>storage<span class="p">);</span>

<span class="w">    </span><span class="c1">// Template management</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_svgs</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_svgAddress</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_svgString</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_svgData</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Template creation</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_createSVG</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="data-structures">Data Structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<h3 id="svgtemplatescontract-struct">SVGTemplatesContract Struct<a class="headerlink" href="#svgtemplatescontract-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">SVGTemplatesContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">address</span><span class="p">)</span><span class="w"> </span>_templates<span class="p">;</span><span class="w">      </span><span class="c1">// Template name to contract address mapping</span>
<span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>_templateNames<span class="p">;</span><span class="w">                    </span><span class="c1">// Array of all template names</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Core storage structure for managing SVG template contracts.</p>
<p><strong>Components</strong>:
- <strong>_templates</strong>: Maps template names to deployed contract addresses
- <strong>_templateNames</strong>: Maintains ordered list of all template names</p>
<h3 id="saltstorage-struct">SaltStorage Struct<a class="headerlink" href="#saltstorage-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">SaltStorage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">salt</span><span class="p">;</span><span class="w">                              </span><span class="c1">// Salt for CREATE2 operations</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Storage for CREATE2 salt values to ensure deterministic addressing.</p>
<h3 id="multipartcontract-struct">MultiPartContract Struct<a class="headerlink" href="#multipartcontract-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">MultiPartContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">name_</span><span class="p">;</span><span class="w">                              </span><span class="c1">// Name of the multi-part template</span>
<span class="w">    </span><span class="kt">bytes</span><span class="p">[]</span><span class="w"> </span>data_<span class="p">;</span><span class="w">                             </span><span class="c1">// Array of SVG component data</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Storage structure for multi-part SVG compositions.</p>
<h3 id="svgstorage-struct">SVGStorage Struct<a class="headerlink" href="#svgstorage-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">SVGStorage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>SVGTemplatesContract<span class="w"> </span>svgTemplates<span class="p">;</span><span class="w">         </span><span class="c1">// Main template storage</span>
<span class="w">    </span>SaltStorage<span class="w"> </span>salt<span class="p">;</span><span class="w">                          </span><span class="c1">// CREATE2 salt storage</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">svgManager</span><span class="p">;</span><span class="w">                        </span><span class="c1">// SVG manager contract address</span>
<span class="w">    </span>MultiPartContract<span class="w"> </span>multiPart<span class="p">;</span><span class="w">               </span><span class="c1">// Multi-part template storage</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Complete Diamond storage structure for SVG functionality.</p>
<p><strong>Storage Position</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">bytes32</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>DIAMOND_STORAGE_POSITION<span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;diamond.nextblock.bitgem.app.SVGStorage.storage&quot;</span><span class="p">);</span>
</code></pre></div>

<h3 id="replacement-struct">Replacement Struct<a class="headerlink" href="#replacement-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">Replacement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">matchString</span><span class="p">;</span><span class="w">                        </span><span class="c1">// String to find in template</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">replaceString</span><span class="p">;</span><span class="w">                      </span><span class="c1">// String to replace with</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Variable substitution data for dynamic SVG rendering.</p>
<h2 id="core-functions">Core Functions<a class="headerlink" href="#core-functions" title="Permanent link">&para;</a></h2>
<h3 id="storage-management">Storage Management<a class="headerlink" href="#storage-management" title="Permanent link">&para;</a></h3>
<h4 id="svgstorage"><code>svgStorage()</code><a class="headerlink" href="#svgstorage" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">svgStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>ds<span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Access Diamond storage for SVG template data using assembly.</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">svgStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>ds<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DIAMOND_STORAGE_POSITION<span class="p">;</span>
<span class="w">    </span>assembly<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ds<span class="p">.</span>slot<span class="w"> </span><span class="o">:=</span><span class="w"> </span>position
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Returns</strong>: Storage reference to SVG template data</p>
<p><strong>Usage</strong>: All SVG functions use this to access persistent storage.</p>
<h3 id="template-management">Template Management<a class="headerlink" href="#template-management" title="Permanent link">&para;</a></h3>
<h4 id="_svgs"><code>_svgs()</code><a class="headerlink" href="#_svgs" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_svgs</span><span class="p">(</span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Retrieve all template names stored in the contract.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to SVG templates contract</p>
<p><strong>Returns</strong>: Array of all template names</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get all available template names</span>
<span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>templateNames<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgs<span class="p">(</span>svgTemplates<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Available templates:&quot;</span><span class="p">,</span><span class="w"> </span>templateNames<span class="p">.</span>length<span class="p">);</span>
</code></pre></div>

<h4 id="_svgaddress"><code>_svgAddress()</code><a class="headerlink" href="#_svgaddress" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_svgAddress</span><span class="p">(</span>
<span class="w">    </span>SVGTemplatesContract<span class="w"> </span>storage<span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Calculate the deterministic address for a template contract.</p>
<p><strong>Parameters</strong>:
- <code>_name</code>: Name of the template</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">return</span><span class="w"> </span>Create2<span class="p">.</span>computeAddress<span class="p">(</span>
<span class="w">    </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>_name<span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="nb">keccak256</span><span class="p">(</span>type<span class="p">(</span>SVGTemplate<span class="p">).</span>creationCode<span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Returns</strong>: Predicted contract address for the named template</p>
<p><strong>Benefits</strong>:
- Enables address prediction before deployment
- Supports deterministic template addressing
- Allows for efficient template lookup</p>
<h4 id="_svgstring"><code>_svgString()</code><a class="headerlink" href="#_svgstring" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_svgString</span><span class="p">(</span>
<span class="w">    </span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data_<span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Retrieve the SVG string content from a deployed template.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to SVG templates contract
- <code>_name</code>: Name of the template</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code>try<span class="w"> </span>SVGTemplate<span class="p">(</span>_svgAddress<span class="p">(</span>self<span class="p">,</span><span class="w"> </span>_name<span class="p">)).</span>svgString<span class="p">()</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_data<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>data_<span class="w"> </span><span class="o">=</span><span class="w"> </span>_data<span class="p">;</span>
<span class="p">}</span><span class="w"> </span>catch<span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<p><strong>Returns</strong>: SVG string content or empty string if template doesn't exist</p>
<p><strong>Error Handling</strong>: Uses try-catch to gracefully handle non-existent templates</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get SVG content for rendering</span>
<span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>svgContent<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;avatar_base&quot;</span><span class="p">);</span>
<span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>svgContent<span class="p">).</span>length<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Process SVG content</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_svgdata"><code>_svgData()</code><a class="headerlink" href="#_svgdata" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_svgData</span><span class="p">(</span>
<span class="w">    </span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Get the stored contract address for a named template.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to SVG templates contract
- <code>_name</code>: Name of the template</p>
<p><strong>Returns</strong>: Contract address of the template or zero address if not found</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Check if template exists</span>
<span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgData<span class="p">(</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;background&quot;</span><span class="p">);</span>
<span class="kt">require</span><span class="p">(</span>templateAddress<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Template not found&quot;</span><span class="p">);</span>
</code></pre></div>

<h3 id="template-creation">Template Creation<a class="headerlink" href="#template-creation" title="Permanent link">&para;</a></h3>
<h4 id="_createsvg"><code>_createSVG()</code><a class="headerlink" href="#_createsvg" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_createSVG</span><span class="p">(</span>
<span class="w">    </span>SVGTemplatesContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_tplAddress</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Deploy a new SVG template contract with deterministic addressing.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to SVG templates contract
- <code>sender</code>: Address that will own the template
- <code>_name</code>: Unique name for the template</p>
<p><strong>Process</strong>:
1. Verify template name is unique
2. Calculate target address using CREATE2
3. Deploy template contract with deterministic salt
4. Verify deployment address matches prediction
5. Transfer ownership to sender
6. Update storage with new template</p>
<p><strong>Security Features</strong>:
- Prevents duplicate template names
- Verifies deployment integrity
- Transfers ownership to creator</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Create a new SVG template</span>
<span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_createSVG<span class="p">(</span>
<span class="w">    </span>svgTemplates<span class="p">,</span>
<span class="w">    </span><span class="k">msg.sender</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;character_base&quot;</span>
<span class="p">);</span>

<span class="c1">// Template is now deployed and owned by msg.sender</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Template deployed at:&quot;</span><span class="p">,</span><span class="w"> </span>templateAddress<span class="p">);</span>
</code></pre></div>

<h2 id="integration-examples">Integration Examples<a class="headerlink" href="#integration-examples" title="Permanent link">&para;</a></h2>
<h3 id="nft-avatar-system">NFT Avatar System<a class="headerlink" href="#nft-avatar-system" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// NFT collection with dynamic SVG avatars</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">AvatarNFT</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>SVGTemplatesLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">AvatarTraits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">background</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">body</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">eyes</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">mouth</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">accessory</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">colorScheme</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>AvatarTraits<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>avatarTraits<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>traitOptions<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">TemplateCreated</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>templateName<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AvatarGenerated</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>AvatarTraits<span class="w"> </span>traits<span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">initializeTemplates</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Create base templates for avatar components</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>templateNames<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">string</span><span class="p">[](</span><span class="m m-Decimal">5</span><span class="p">);</span>
<span class="w">        </span>templateNames<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;background_template&quot;</span><span class="p">;</span>
<span class="w">        </span>templateNames<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;body_template&quot;</span><span class="p">;</span>
<span class="w">        </span>templateNames<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;eyes_template&quot;</span><span class="p">;</span>
<span class="w">        </span>templateNames<span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mouth_template&quot;</span><span class="p">;</span>
<span class="w">        </span>templateNames<span class="p">[</span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;accessory_template&quot;</span><span class="p">;</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>templateNames<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_createSVG<span class="p">(</span>
<span class="w">                </span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span>
<span class="w">                </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span>
<span class="w">                </span>templateNames<span class="p">[</span>i<span class="p">]</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span>emit<span class="w"> </span>TemplateCreated<span class="p">(</span>templateNames<span class="p">[</span>i<span class="p">],</span><span class="w"> </span>templateAddress<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Initialize trait options</span>
<span class="w">        </span>traitOptions<span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ocean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="p">];</span>
<span class="w">        </span>traitOptions<span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;human&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;robot&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;alien&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;animal&quot;</span><span class="p">];</span>
<span class="w">        </span>traitOptions<span class="p">[</span><span class="s2">&quot;eyes&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;glowing&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mechanical&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;large&quot;</span><span class="p">];</span>
<span class="w">        </span>traitOptions<span class="p">[</span><span class="s2">&quot;mouth&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;smile&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;frown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;neutral&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fangs&quot;</span><span class="p">];</span>
<span class="w">        </span>traitOptions<span class="p">[</span><span class="s2">&quot;accessory&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;glasses&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;necklace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">generateAvatar</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">seed</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Generate random traits based on seed</span>
<span class="w">        </span>AvatarTraits<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>traits<span class="w"> </span><span class="o">=</span><span class="w"> </span>AvatarTraits<span class="p">({</span>
<span class="w">            </span>background<span class="o">:</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">][</span>seed<span class="w"> </span><span class="o">%</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">].</span>length<span class="p">],</span>
<span class="w">            </span>body<span class="o">:</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][(</span>seed<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">].</span>length<span class="p">],</span>
<span class="w">            </span>eyes<span class="o">:</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;eyes&quot;</span><span class="p">][(</span>seed<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;eyes&quot;</span><span class="p">].</span>length<span class="p">],</span>
<span class="w">            </span>mouth<span class="o">:</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;mouth&quot;</span><span class="p">][(</span>seed<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;mouth&quot;</span><span class="p">].</span>length<span class="p">],</span>
<span class="w">            </span>accessory<span class="o">:</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;accessory&quot;</span><span class="p">][(</span>seed<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">10000</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>traitOptions<span class="p">[</span><span class="s2">&quot;accessory&quot;</span><span class="p">].</span>length<span class="p">],</span>
<span class="w">            </span>colorScheme<span class="o">:</span><span class="w"> </span>seed<span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m m-Decimal">10</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>avatarTraits<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>traits<span class="p">;</span>
<span class="w">        </span>emit<span class="w"> </span>AvatarGenerated<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>traits<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">tokenURI</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span>override<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>svgContent<span class="w"> </span><span class="o">=</span><span class="w"> </span>generateSVG<span class="p">(</span>tokenId<span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>json<span class="w"> </span><span class="o">=</span><span class="w"> </span>Base64<span class="p">.</span>encode<span class="p">(</span>
<span class="w">            </span><span class="kt">bytes</span><span class="p">(</span>
<span class="w">                </span><span class="kt">string</span><span class="p">(</span>
<span class="w">                    </span>abi<span class="p">.</span>encodePacked<span class="p">(</span>
<span class="w">                        </span><span class="s1">&#39;{&quot;name&quot;: &quot;Avatar #&#39;</span><span class="p">,</span>
<span class="w">                        </span>Strings<span class="p">.</span>toString<span class="p">(</span>tokenId<span class="p">),</span>
<span class="w">                        </span><span class="s1">&#39;&quot;, &quot;description&quot;: &quot;Dynamic SVG Avatar&quot;, &quot;image&quot;: &quot;data:image/svg+xml;base64,&#39;</span><span class="p">,</span>
<span class="w">                        </span>Base64<span class="p">.</span>encode<span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>svgContent<span class="p">)),</span>
<span class="w">                        </span><span class="s1">&#39;&quot;, &quot;attributes&quot;: &#39;</span><span class="p">,</span>
<span class="w">                        </span>generateAttributes<span class="p">(</span>tokenId<span class="p">),</span>
<span class="w">                        </span><span class="s1">&#39;}&#39;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;data:application/json;base64,&quot;</span><span class="p">,</span><span class="w"> </span>json<span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">generateSVG</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>
<span class="w">        </span>AvatarTraits<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>traits<span class="w"> </span><span class="o">=</span><span class="w"> </span>avatarTraits<span class="p">[</span>tokenId<span class="p">];</span>

<span class="w">        </span><span class="c1">// Get base templates</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>backgroundSVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;background_template&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>bodySVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;body_template&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>eyesSVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;eyes_template&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>mouthSVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;mouth_template&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>accessorySVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span><span class="s2">&quot;accessory_template&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Create replacements for dynamic content</span>
<span class="w">        </span>Replacement<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>replacements<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Replacement<span class="p">[](</span><span class="m m-Decimal">6</span><span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{BACKGROUND_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>background<span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{BODY_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>body<span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{EYES_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>eyes<span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{MOUTH_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>mouth<span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{ACCESSORY_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>accessory<span class="p">);</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{COLOR_SCHEME}}&quot;</span><span class="p">,</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>traits<span class="p">.</span>colorScheme<span class="p">));</span>

<span class="w">        </span><span class="c1">// Build complete SVG</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>
<span class="w">            </span>abi<span class="p">.</span>encodePacked<span class="p">(</span>
<span class="w">                </span><span class="s1">&#39;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 400 400&quot;&gt;&#39;</span><span class="p">,</span>
<span class="w">                </span>applyReplacements<span class="p">(</span>backgroundSVG<span class="p">,</span><span class="w"> </span>replacements<span class="p">),</span>
<span class="w">                </span>applyReplacements<span class="p">(</span>bodySVG<span class="p">,</span><span class="w"> </span>replacements<span class="p">),</span>
<span class="w">                </span>applyReplacements<span class="p">(</span>eyesSVG<span class="p">,</span><span class="w"> </span>replacements<span class="p">),</span>
<span class="w">                </span>applyReplacements<span class="p">(</span>mouthSVG<span class="p">,</span><span class="w"> </span>replacements<span class="p">),</span>
<span class="w">                </span>applyReplacements<span class="p">(</span>accessorySVG<span class="p">,</span><span class="w"> </span>replacements<span class="p">),</span>
<span class="w">                </span><span class="s1">&#39;&lt;/svg&gt;&#39;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">generateAttributes</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>AvatarTraits<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>traits<span class="w"> </span><span class="o">=</span><span class="w"> </span>avatarTraits<span class="p">[</span>tokenId<span class="p">];</span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>
<span class="w">            </span>abi<span class="p">.</span>encodePacked<span class="p">(</span>
<span class="w">                </span><span class="s1">&#39;[&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Background&quot;, &quot;value&quot;: &quot;&#39;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>background<span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;},&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Body&quot;, &quot;value&quot;: &quot;&#39;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>body<span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;},&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Eyes&quot;, &quot;value&quot;: &quot;&#39;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>eyes<span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;},&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Mouth&quot;, &quot;value&quot;: &quot;&#39;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>mouth<span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;},&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Accessory&quot;, &quot;value&quot;: &quot;&#39;</span><span class="p">,</span><span class="w"> </span>traits<span class="p">.</span>accessory<span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;},&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;{&quot;trait_type&quot;: &quot;Color Scheme&quot;, &quot;value&quot;: &#39;</span><span class="p">,</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>traits<span class="p">.</span>colorScheme<span class="p">),</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;]&#39;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">applyReplacements</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>template<span class="p">,</span><span class="w"> </span>Replacement<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>replacements<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>result<span class="w"> </span><span class="o">=</span><span class="w"> </span>template<span class="p">;</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>replacements<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>result<span class="w"> </span><span class="o">=</span><span class="w"> </span>StringsLib<span class="p">.</span>replace<span class="p">(</span>result<span class="p">,</span><span class="w"> </span>replacements<span class="p">[</span>i<span class="p">].</span>matchString<span class="p">,</span><span class="w"> </span>replacements<span class="p">[</span>i<span class="p">].</span>replaceString<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>result<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_exists</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="gaming-asset-renderer">Gaming Asset Renderer<a class="headerlink" href="#gaming-asset-renderer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Dynamic SVG rendering for gaming assets</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">GameAssetRenderer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>SVGTemplatesLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">AssetTemplate</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">category</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>requiredVariables<span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">active</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">AssetInstance</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">templateName</span><span class="p">;</span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span>variables<span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">lastUpdated</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>AssetTemplate<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>assetTemplates<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>AssetInstance<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>assetInstances<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>categoryTemplates<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AssetTemplateRegistered</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>templateName<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">category</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AssetRendered</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>assetId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">templateName</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AssetVariableUpdated</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>assetId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">variable</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">registerAssetTemplate</span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>category<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>requiredVariables<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>svgTemplate
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyGameMaster<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Create SVG template contract</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_createSVG<span class="p">(</span>
<span class="w">            </span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span>
<span class="w">            </span>templateName
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Initialize template with SVG content</span>
<span class="w">        </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>clear<span class="p">();</span>
<span class="w">        </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>add<span class="p">(</span>svgTemplate<span class="p">);</span>

<span class="w">        </span><span class="c1">// Register template metadata</span>
<span class="w">        </span>assetTemplates<span class="p">[</span>templateName<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AssetTemplate<span class="p">({</span>
<span class="w">            </span>name<span class="o">:</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">            </span>category<span class="o">:</span><span class="w"> </span>category<span class="p">,</span>
<span class="w">            </span>requiredVariables<span class="o">:</span><span class="w"> </span>requiredVariables<span class="p">,</span>
<span class="w">            </span>active<span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>categoryTemplates<span class="p">[</span>category<span class="p">].</span>push<span class="p">(</span>templateName<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>AssetTemplateRegistered<span class="p">(</span>templateName<span class="p">,</span><span class="w"> </span>category<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createAsset</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">assetId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>variableNames<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>variableValues
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>assetTemplates<span class="p">[</span>templateName<span class="p">].</span>active<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Template not active&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>variableNames<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>variableValues<span class="p">.</span>length<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Variable arrays length mismatch&quot;</span><span class="p">);</span>

<span class="w">        </span>AssetInstance<span class="w"> </span>storage<span class="w"> </span>instance<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetInstances<span class="p">[</span>assetId<span class="p">];</span>
<span class="w">        </span>instance<span class="p">.</span>templateName<span class="w"> </span><span class="o">=</span><span class="w"> </span>templateName<span class="p">;</span>
<span class="w">        </span>instance<span class="p">.</span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Set variables</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>variableNames<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>instance<span class="p">.</span>variables<span class="p">[</span>variableNames<span class="p">[</span>i<span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>variableValues<span class="p">[</span>i<span class="p">];</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>emit<span class="w"> </span>AssetRendered<span class="p">(</span>assetId<span class="p">,</span><span class="w"> </span>templateName<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">updateAssetVariable</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">assetId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>variableName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>variableValue
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>AssetInstance<span class="w"> </span>storage<span class="w"> </span>instance<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetInstances<span class="p">[</span>assetId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>instance<span class="p">.</span>templateName<span class="p">).</span>length<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Asset does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>instance<span class="p">.</span>variables<span class="p">[</span>variableName<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>variableValue<span class="p">;</span>
<span class="w">        </span>instance<span class="p">.</span>lastUpdated<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>

<span class="w">        </span>emit<span class="w"> </span>AssetVariableUpdated<span class="p">(</span>assetId<span class="p">,</span><span class="w"> </span>variableName<span class="p">,</span><span class="w"> </span>variableValue<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">renderAsset</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">assetId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>AssetInstance<span class="w"> </span>storage<span class="w"> </span>instance<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetInstances<span class="p">[</span>assetId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>instance<span class="p">.</span>templateName<span class="p">).</span>length<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Asset does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>
<span class="w">        </span>AssetTemplate<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>template<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetTemplates<span class="p">[</span>instance<span class="p">.</span>templateName<span class="p">];</span>

<span class="w">        </span><span class="c1">// Get template SVG</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateSVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>
<span class="w">            </span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span>
<span class="w">            </span>instance<span class="p">.</span>templateName
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Build replacements array</span>
<span class="w">        </span>Replacement<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>replacements<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Replacement<span class="p">[](</span>template<span class="p">.</span>requiredVariables<span class="p">.</span>length<span class="p">);</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>template<span class="p">.</span>requiredVariables<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>variable<span class="w"> </span><span class="o">=</span><span class="w"> </span>template<span class="p">.</span>requiredVariables<span class="p">[</span>i<span class="p">];</span>
<span class="w">            </span>replacements<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">({</span>
<span class="w">                </span>matchString<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;{{&quot;</span><span class="p">,</span><span class="w"> </span>variable<span class="p">,</span><span class="w"> </span><span class="s2">&quot;}}&quot;</span><span class="p">)),</span>
<span class="w">                </span>replaceString<span class="o">:</span><span class="w"> </span>instance<span class="p">.</span>variables<span class="p">[</span>variable<span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Apply replacements using template contract</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgAddress<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span>instance<span class="p">.</span>templateName<span class="p">);</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>buildSVG<span class="p">(</span>replacements<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getAssetMetadata</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">assetId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>category<span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">lastUpdated</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>AssetInstance<span class="w"> </span>storage<span class="w"> </span>instance<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetInstances<span class="p">[</span>assetId<span class="p">];</span>
<span class="w">        </span>AssetTemplate<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>template<span class="w"> </span><span class="o">=</span><span class="w"> </span>assetTemplates<span class="p">[</span>instance<span class="p">.</span>templateName<span class="p">];</span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span>instance<span class="p">.</span>templateName<span class="p">,</span>
<span class="w">            </span>template<span class="p">.</span>category<span class="p">,</span>
<span class="w">            </span>instance<span class="p">.</span>lastUpdated
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getCategoryTemplates</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>category<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>categoryTemplates<span class="p">[</span>category<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getTemplateVariables</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>assetTemplates<span class="p">[</span>templateName<span class="p">].</span>requiredVariables<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyGameMaster<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="certificate-generator">Certificate Generator<a class="headerlink" href="#certificate-generator" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Dynamic certificate generation with SVG templates</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">CertificateGenerator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>SVGTemplatesLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">CertificateType</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">templateName</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>requiredFields<span class="p">;</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">issuer</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">active</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Certificate</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">certificateId</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">certificateType</span><span class="p">;</span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span>fields<span class="p">;</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">issuedAt</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">revoked</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>CertificateType<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>certificateTypes<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Certificate<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>certificates<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>recipientCertificates<span class="p">;</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">nextCertificateId</span><span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">CertificateTypeCreated</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>typeName<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>issuer<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">CertificateIssued</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>certificateId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>recipient<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">typeName</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">CertificateRevoked</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>certificateId<span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createCertificateType</span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>typeName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>requiredFields<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>svgTemplate
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>templateName<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;cert_&quot;</span><span class="p">,</span><span class="w"> </span>typeName<span class="p">));</span>

<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Create SVG template</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_createSVG<span class="p">(</span>
<span class="w">            </span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span>
<span class="w">            </span>templateName
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Initialize template with certificate SVG</span>
<span class="w">        </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>clear<span class="p">();</span>
<span class="w">        </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>add<span class="p">(</span>svgTemplate<span class="p">);</span>

<span class="w">        </span><span class="c1">// Register certificate type</span>
<span class="w">        </span>certificateTypes<span class="p">[</span>typeName<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CertificateType<span class="p">({</span>
<span class="w">            </span>name<span class="o">:</span><span class="w"> </span>typeName<span class="p">,</span>
<span class="w">            </span>templateName<span class="o">:</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">            </span>requiredFields<span class="o">:</span><span class="w"> </span>requiredFields<span class="p">,</span>
<span class="w">            </span>issuer<span class="o">:</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span>
<span class="w">            </span>active<span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>emit<span class="w"> </span>CertificateTypeCreated<span class="p">(</span>typeName<span class="p">,</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">issueCertificate</span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>typeName<span class="p">,</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>fieldNames<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>fieldValues
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">certificateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>CertificateType<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>certType<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificateTypes<span class="p">[</span>typeName<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>certType<span class="p">.</span>active<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Certificate type not active&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>certType<span class="p">.</span>issuer<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not authorized issuer&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>fieldNames<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>fieldValues<span class="p">.</span>length<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Field arrays length mismatch&quot;</span><span class="p">);</span>

<span class="w">        </span>certificateId<span class="w"> </span><span class="o">=</span><span class="w"> </span>nextCertificateId<span class="o">++</span><span class="p">;</span>

<span class="w">        </span>Certificate<span class="w"> </span>storage<span class="w"> </span>cert<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificates<span class="p">[</span>certificateId<span class="p">];</span>
<span class="w">        </span>cert<span class="p">.</span>certificateId<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificateId<span class="p">;</span>
<span class="w">        </span>cert<span class="p">.</span>certificateType<span class="w"> </span><span class="o">=</span><span class="w"> </span>typeName<span class="p">;</span>
<span class="w">        </span>cert<span class="p">.</span>recipient<span class="w"> </span><span class="o">=</span><span class="w"> </span>recipient<span class="p">;</span>
<span class="w">        </span>cert<span class="p">.</span>issuedAt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span>
<span class="w">        </span>cert<span class="p">.</span>revoked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Set certificate fields</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>fieldNames<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>cert<span class="p">.</span>fields<span class="p">[</span>fieldNames<span class="p">[</span>i<span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fieldValues<span class="p">[</span>i<span class="p">];</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>recipientCertificates<span class="p">[</span>recipient<span class="p">].</span>push<span class="p">(</span>certificateId<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>CertificateIssued<span class="p">(</span>certificateId<span class="p">,</span><span class="w"> </span>recipient<span class="p">,</span><span class="w"> </span>typeName<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">revokeCertificate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">certificateId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Certificate<span class="w"> </span>storage<span class="w"> </span>cert<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificates<span class="p">[</span>certificateId<span class="p">];</span>
<span class="w">        </span>CertificateType<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>certType<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificateTypes<span class="p">[</span>cert<span class="p">.</span>certificateType<span class="p">];</span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>certType<span class="p">.</span>issuer<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not authorized issuer&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>cert<span class="p">.</span>revoked<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Certificate already revoked&quot;</span><span class="p">);</span>

<span class="w">        </span>cert<span class="p">.</span>revoked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">        </span>emit<span class="w"> </span>CertificateRevoked<span class="p">(</span>certificateId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">generateCertificateSVG</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">certificateId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Certificate<span class="w"> </span>storage<span class="w"> </span>cert<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificates<span class="p">[</span>certificateId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>cert<span class="p">.</span>issuedAt<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Certificate does not exist&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>cert<span class="p">.</span>revoked<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Certificate revoked&quot;</span><span class="p">);</span>

<span class="w">        </span>CertificateType<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>certType<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificateTypes<span class="p">[</span>cert<span class="p">.</span>certificateType<span class="p">];</span>
<span class="w">        </span>SVGTemplatesLib<span class="p">.</span>SVGStorage<span class="w"> </span>storage<span class="w"> </span>svgStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>svgStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Get template SVG</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateSVG<span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgString<span class="p">(</span>
<span class="w">            </span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span>
<span class="w">            </span>certType<span class="p">.</span>templateName
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Build replacements for certificate fields</span>
<span class="w">        </span>Replacement<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>replacements<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Replacement<span class="p">[](</span>certType<span class="p">.</span>requiredFields<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Standard certificate fields</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{CERTIFICATE_ID}}&quot;</span><span class="p">,</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>certificateId<span class="p">));</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{RECIPIENT}}&quot;</span><span class="p">,</span><span class="w"> </span>Strings<span class="p">.</span>toHexString<span class="p">(</span><span class="kt">uint160</span><span class="p">(</span>cert<span class="p">.</span>recipient<span class="p">),</span><span class="w"> </span><span class="m m-Decimal">20</span><span class="p">));</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{ISSUE_DATE}}&quot;</span><span class="p">,</span><span class="w"> </span>formatTimestamp<span class="p">(</span>cert<span class="p">.</span>issuedAt<span class="p">));</span>
<span class="w">        </span>replacements<span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">(</span><span class="s2">&quot;{{CERTIFICATE_TYPE}}&quot;</span><span class="p">,</span><span class="w"> </span>cert<span class="p">.</span>certificateType<span class="p">);</span>

<span class="w">        </span><span class="c1">// Custom fields</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>certType<span class="p">.</span>requiredFields<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>fieldName<span class="w"> </span><span class="o">=</span><span class="w"> </span>certType<span class="p">.</span>requiredFields<span class="p">[</span>i<span class="p">];</span>
<span class="w">            </span>replacements<span class="p">[</span>i<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Replacement<span class="p">({</span>
<span class="w">                </span>matchString<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;{{&quot;</span><span class="p">,</span><span class="w"> </span>fieldName<span class="p">,</span><span class="w"> </span><span class="s2">&quot;}}&quot;</span><span class="p">)),</span>
<span class="w">                </span>replaceString<span class="o">:</span><span class="w"> </span>cert<span class="p">.</span>fields<span class="p">[</span>fieldName<span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Apply replacements</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">templateAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SVGTemplatesLib<span class="p">.</span>_svgAddress<span class="p">(</span>svgStorage<span class="p">.</span>svgTemplates<span class="p">,</span><span class="w"> </span>certType<span class="p">.</span>templateName<span class="p">);</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ISVGTemplate<span class="p">(</span>templateAddress<span class="p">).</span>buildSVG<span class="p">(</span>replacements<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getCertificateMetadata</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">certificateId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>certificateType<span class="p">,</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">issuedAt</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">revoked</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Certificate<span class="w"> </span>storage<span class="w"> </span>cert<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificates<span class="p">[</span>certificateId<span class="p">];</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span>cert<span class="p">.</span>certificateType<span class="p">,</span>
<span class="w">            </span>cert<span class="p">.</span>recipient<span class="p">,</span>
<span class="w">            </span>cert<span class="p">.</span>issuedAt<span class="p">,</span>
<span class="w">            </span>cert<span class="p">.</span>revoked
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getRecipientCertificates</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>recipientCertificates<span class="p">[</span>recipient<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">formatTimestamp</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Simple timestamp formatting - in production, use a proper date library</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>timestamp<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<h3 id="svg-template-events">SVG Template Events<a class="headerlink" href="#svg-template-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">event</span><span class="w"> </span><span class="nv">SVGTemplateCreated</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">template</span><span class="p">);</span>
</code></pre></div>

<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<h3 id="template-deployment-security">Template Deployment Security<a class="headerlink" href="#template-deployment-security" title="Permanent link">&para;</a></h3>
<ul>
<li>CREATE2 ensures deterministic addressing</li>
<li>Ownership transfer to template creator</li>
<li>Unique name validation prevents conflicts</li>
<li>Address verification ensures deployment integrity</li>
</ul>
<h3 id="access-control">Access Control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h3>
<ul>
<li>Template ownership controls content updates</li>
<li>Manager role for SVG system administration</li>
<li>Template-specific permissions for modifications</li>
<li>Secure template registry management</li>
</ul>
<h3 id="content-validation">Content Validation<a class="headerlink" href="#content-validation" title="Permanent link">&para;</a></h3>
<ul>
<li>SVG content validation before storage</li>
<li>Safe string replacement operations</li>
<li>Protection against malicious template content</li>
<li>Graceful error handling for missing templates</li>
</ul>
<h2 id="gas-optimization">Gas Optimization<a class="headerlink" href="#gas-optimization" title="Permanent link">&para;</a></h2>
<h3 id="storage-efficiency">Storage Efficiency<a class="headerlink" href="#storage-efficiency" title="Permanent link">&para;</a></h3>
<ul>
<li>Efficient template name storage</li>
<li>Minimal storage writes during creation</li>
<li>Optimized address calculation</li>
<li>Batch template operations where possible</li>
</ul>
<h3 id="rendering-efficiency">Rendering Efficiency<a class="headerlink" href="#rendering-efficiency" title="Permanent link">&para;</a></h3>
<ul>
<li>Lazy template loading</li>
<li>Efficient string operations</li>
<li>Minimal external calls</li>
<li>Optimized replacement algorithms</li>
</ul>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="common-errors">Common Errors<a class="headerlink" href="#common-errors" title="Permanent link">&para;</a></h3>
<ul>
<li>"template already deployed" - Duplicate template name</li>
<li>"template address mismatch" - CREATE2 deployment failure</li>
<li>Template not found - Graceful empty string return</li>
<li>Invalid template content - Validation failures</li>
</ul>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li>Validate template names before creation</li>
<li>Check template existence before rendering</li>
<li>Handle missing templates gracefully</li>
<li>Provide clear error messages for debugging</li>
</ul>
<h2 id="testing-considerations">Testing Considerations<a class="headerlink" href="#testing-considerations" title="Permanent link">&para;</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Template creation and deployment</li>
<li>Address calculation accuracy</li>
<li>SVG content retrieval</li>
<li>Ownership transfer functionality</li>
</ul>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Multi-template rendering workflows</li>
<li>Variable substitution accuracy</li>
<li>Template registry management</li>
<li>Cross-contract template usage</li>
</ul>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../interfaces/isvg/">ISVG Interface</a> - SVG interface definitions</li>
<li><a href="../../facets/svg-templates-facet/">SVGTemplatesFacet</a> - SVG templates facet implementation</li>
<li><a href="../strings-lib/">StringsLib</a> - String manipulation utilities</li>
<li><a href="../../guides/nft-metadata.md">NFT Metadata Guide</a> - NFT metadata best practices</li>
<li><a href="../../guides/svg-generation.md">SVG Generation Guide</a> - SVG template creation guide</li>
</ul>
<hr />
<p><em>This library provides comprehensive utilities for on-chain SVG template management within the Gemforce platform, enabling dynamic generation of graphics for NFTs, certificates, gaming assets, and other visual content with variable substitution and multi-part composition capabilities.</em></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../diamond-factory-lib/" class="btn btn-neutral float-left" title="Diamond Factory Lib"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../attribute-lib/" class="btn btn-neutral float-right" title="Attribute Lib">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../diamond-factory-lib/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../attribute-lib/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
