<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gemforce Team" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Attribute Lib - Gemforce Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Attribute Lib";
        var mkdocs_page_input_path = "smart-contracts/libraries/attribute-lib.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Gemforce Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../developer-setup-guide/">Developer Setup Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../system-architecture/gemforce-system-architecture/">System Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Contracts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../diamond/">Diamond Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../diamond-factory/">Diamond Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../identity-factory/">Identity Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Facets</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/marketplace-facet/">Marketplace Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-management-facet/">Trade Deal Management Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/carbon-credit-facet/">Carbon Credit Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/identity-registry-facet/">Identity Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trusted-issuers-registry-facet/">Trusted Issuers Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/fee-distributor-facet/">Fee Distributor Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/gemforce-minter-facet/">Gemforce Minter Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/multi-sale-facet/">Multi Sale Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/svg-templates-facet/">SVG Templates Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-admin-facet/">Trade Deal Admin Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/trade-deal-operations-facet/">Trade Deal Operations Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/collateral-token-factory-facet/">Collateral Token Factory Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/diamond-cut-facet/">Diamond Cut Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/diamond-loupe-facet/">Diamond Loupe Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../facets/ownership-facet/">Ownership Facet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Interfaces</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/idiamond/">IDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/imarketplace/">IMarketplace</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/itradedeal/">ITradeDeal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/icarbon-credit/">ICarbonCredit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc1155-mint/">IERC1155Mint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc734/">IERC734</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc735/">IERC735</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ierc721a/">IERC721A</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/idiamond-factory/">IDiamondFactory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iidentity/">IIdentity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/imultisale/">IMultiSale</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/ifee-distributor/">IFeeDistributor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/igemforce-minter-facet/">IGemforceMinterFacet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iidentity-registry/">IIdentityRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/itrusted-issuers-registry/">TRUSTEDIssuersRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/isvg/">ISVG</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/iattribute/">IAttribute</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Libraries</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../carbon-credit-lib/">Carbon Credit Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trade-deal-lib/">Trade Deal Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../multi-sale-lib/">Multi Sale Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../diamond-factory-lib/">Diamond Factory Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../svg-templates-lib/">SVG Templates Lib</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Attribute Lib</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-features">Key Features</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#library-definition">Library Definition</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-structures">Data Structures</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#attributetype-enum">AttributeType Enum</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#attribute-struct">Attribute Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#attributecontract-struct">AttributeContract Struct</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#attributestorage-struct">AttributeStorage Struct</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#core-functions">Core Functions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#storage-management">Storage Management</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#attribute-retrieval">Attribute Retrieval</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#attribute-modification">Attribute Modification</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#token-lifecycle">Token Lifecycle</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-examples">Integration Examples</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#nft-collection-with-dynamic-attributes">NFT Collection with Dynamic Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#gaming-item-system">Gaming Item System</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#certificate-system-with-verifiable-attributes">Certificate System with Verifiable Attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#events">Events</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#attribute-events">Attribute Events</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#security-considerations">Security Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#burn-protection">Burn Protection</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#access-control">Access Control</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#access-control_1">Access Control</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#data-integrity">Data Integrity</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gas-optimization">Gas Optimization</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#storage-efficiency">Storage Efficiency</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#function-efficiency">Function Efficiency</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#common-errors">Common Errors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-considerations">Testing Considerations</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit Tests</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#integration-tests">Integration Tests</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#edge-cases">Edge Cases</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../variable-price-lib/">Variable Price Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../merkle-prover/">Merkle Prover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fee-distributor-lib/">Fee Distributor Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lib-diamond/">LibDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../diamond-lib/">DiamondLib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../erc721a-lib/">ERC721A Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../erc721a-enumeration-lib/">ERC721A Enumeration Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../strings-lib/">Strings Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trusted-issuer-lib/">Trusted Issuer Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../set-libraries/">Set Libraries</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SDK & Libraries</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/blockchain/">Blockchain Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/diamond/">Diamond Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/contract/">Contract Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/deploy/">Deployment Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/validation-utils/">Validation Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../sdk-libraries/nft-sale-utils/">NFT Sale Utilities</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Functions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/authentication/">Authentication Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/auth-functions/">Auth Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/blockchain/">Blockchain Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/bridge/">Bridge Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/contracts/">Contract Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/deploy/">Deploy Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/dfns/">DFNS Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/project/">Project Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/trade-deal/">Trade Deal Functions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-documentation/">Full API Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api-documentation/gemforce-api-quick-reference/">Quick Reference</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Operations Tasks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/diamond/">Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/identities/">Identity Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/marketplace-management/">Marketplace Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/carbon-credit-management/">Carbon Credit Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/trade-deal/">Trade Deal Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test/">Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test-marketplace/">Marketplace Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/integration-test-trade-deal/">Trade Deal Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/admin-utils/">Admin Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/sync-diamond/">Sync Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../cloud-functions/tasks/sync-events/">Sync Events Tasks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">EIPs (Ethereum Improvement Proposals)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Enhanced-Marketplace/">Diamond-Enhanced Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Multi-Token-Sale-Standard/">Multi-Token Sale Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Collateralized-Trade-Deal-Standard/">Collateralized Trade Deal Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Enhanced-Identity-System/">Enhanced Identity System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Diamond-Factory-Standard/">Diamond Factory Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../eips/EIP-DRAFT-Carbon-Credit-Standard/">Carbon Credit Standard</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-administrator-guide/">Administrator Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-deployer-guide/">Deployer Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-integrator-guide/">Integrator Guide</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Integrator's Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/rest-api/">REST API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/smart-contracts/">Smart Contracts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/dfns/">DFNS Integration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/webhooks/">Webhooks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/error-handling/">Error Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/sample-code/">Sample Code</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/integration-patterns/">Integration Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../integrator-guide/security/">Security</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../external-services/gemforce-external-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../gemforce-documentation-gap-analysis/">Documentation Gap Analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-progress-summary/">Documentation Progress Summary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../documentation-plan/">Documentation Plan</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Gemforce Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Smart Contracts</li>
          <li class="breadcrumb-item">Libraries</li>
      <li class="breadcrumb-item active">Attribute Lib</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="attributelib-library">AttributeLib Library<a class="headerlink" href="#attributelib-library" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <a href="../../../contracts/libraries/AttributeLib.sol"><code>AttributeLib</code></a> library provides core utilities for managing token attributes within the Gemforce platform. This library implements a flexible attribute system that allows tokens to have dynamic, typed metadata stored on-chain, supporting various data types and efficient key-value storage.</p>
<h2 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Typed Attributes</strong>: Support for multiple data types (String, Bytes32, Uint256, Arrays)</li>
<li><strong>Dynamic Metadata</strong>: Runtime attribute assignment and modification</li>
<li><strong>Efficient Storage</strong>: Optimized key-value storage with indexing</li>
<li><strong>Burn Protection</strong>: Prevents attribute operations on burned tokens</li>
<li><strong>Batch Operations</strong>: Support for setting multiple attributes simultaneously</li>
<li><strong>Event Tracking</strong>: Comprehensive event emission for attribute changes</li>
</ul>
<h2 id="library-definition">Library Definition<a class="headerlink" href="#library-definition" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.6</span><span class="p">;</span>

<span class="kt">library</span><span class="w"> </span>AttributeLib<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Storage management</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">attributeStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>AttributeStorage<span class="w"> </span>storage<span class="p">);</span>

<span class="w">    </span><span class="c1">// Attribute retrieval</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttribute</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>key<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttributeValues</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttributeKeys</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Attribute modification</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_setAttribute</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attribute<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="p">;</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_setAttributes</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>_attributes<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="p">;</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_removeAttribute</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>key<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Token lifecycle</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_burn</span><span class="p">(</span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="data-structures">Data Structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<h3 id="attributetype-enum">AttributeType Enum<a class="headerlink" href="#attributetype-enum" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">enum</span><span class="w"> </span><span class="nv">AttributeType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>Unknown<span class="p">,</span><span class="w">        </span><span class="c1">// Undefined type</span>
<span class="w">    </span>String<span class="p">,</span><span class="w">         </span><span class="c1">// String value</span>
<span class="w">    </span>Bytes32<span class="p">,</span><span class="w">        </span><span class="c1">// 32-byte value</span>
<span class="w">    </span>Uint256<span class="p">,</span><span class="w">        </span><span class="c1">// 256-bit unsigned integer</span>
<span class="w">    </span>Uint8<span class="p">,</span><span class="w">          </span><span class="c1">// 8-bit unsigned integer</span>
<span class="w">    </span>Uint256Array<span class="p">,</span><span class="w">   </span><span class="c1">// Array of 256-bit unsigned integers</span>
<span class="w">    </span>Uint8Array<span class="w">      </span><span class="c1">// Array of 8-bit unsigned integers</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Defines supported attribute data types for type-safe operations.</p>
<h3 id="attribute-struct">Attribute Struct<a class="headerlink" href="#attribute-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">Attribute</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">key</span><span class="p">;</span><span class="w">                     </span><span class="c1">// Attribute identifier</span>
<span class="w">    </span>AttributeType<span class="w"> </span>attributeType<span class="p">;</span><span class="w">    </span><span class="c1">// Type of the attribute value</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">value</span><span class="p">;</span><span class="w">                   </span><span class="c1">// String representation of the value</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Core attribute data structure containing key, type, and value.</p>
<p><strong>Design Notes</strong>:
- All values stored as strings for simplicity and gas efficiency
- Type information preserved for proper interpretation
- Key serves as unique identifier within token scope</p>
<h3 id="attributecontract-struct">AttributeContract Struct<a class="headerlink" href="#attributecontract-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">AttributeContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>burnedIds<span class="p">;</span><span class="w">                                     </span><span class="c1">// Burned token tracking</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Attribute<span class="p">))</span><span class="w"> </span>attributes<span class="p">;</span><span class="w">            </span><span class="c1">// Token attributes</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span>attributeKeys<span class="p">;</span><span class="w">                            </span><span class="c1">// Token attribute keys</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">))</span><span class="w"> </span>attributeKeysIndexes<span class="p">;</span><span class="w">   </span><span class="c1">// Key index mapping</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Complete storage structure for token attribute management.</p>
<p><strong>Components</strong>:
- <strong>burnedIds</strong>: Tracks burned tokens to prevent attribute operations
- <strong>attributes</strong>: Nested mapping for token-specific attribute storage
- <strong>attributeKeys</strong>: Ordered list of attribute keys per token
- <strong>attributeKeysIndexes</strong>: Efficient key lookup and removal indexing</p>
<h3 id="attributestorage-struct">AttributeStorage Struct<a class="headerlink" href="#attributestorage-struct" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">struct</span><span class="w"> </span><span class="nv">AttributeStorage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>attributes<span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Purpose</strong>: Diamond storage wrapper for attribute data.</p>
<p><strong>Storage Position</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">bytes32</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>DIAMOND_STORAGE_POSITION<span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;diamond.nextblock.bitgem.app.AttributeStorage.storage&quot;</span><span class="p">);</span>
</code></pre></div>

<h2 id="core-functions">Core Functions<a class="headerlink" href="#core-functions" title="Permanent link">&para;</a></h2>
<h3 id="storage-management">Storage Management<a class="headerlink" href="#storage-management" title="Permanent link">&para;</a></h3>
<h4 id="attributestorage"><code>attributeStorage()</code><a class="headerlink" href="#attributestorage" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">attributeStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>ds<span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Access Diamond storage for attribute data using assembly.</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">attributeStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>ds<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DIAMOND_STORAGE_POSITION<span class="p">;</span>
<span class="w">    </span>assembly<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ds<span class="p">.</span>slot<span class="w"> </span><span class="o">:=</span><span class="w"> </span>position
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Returns</strong>: Storage reference to attribute data</p>
<p><strong>Usage</strong>: All attribute functions use this to access persistent storage.</p>
<h3 id="attribute-retrieval">Attribute Retrieval<a class="headerlink" href="#attribute-retrieval" title="Permanent link">&para;</a></h3>
<h4 id="_getattribute"><code>_getAttribute()</code><a class="headerlink" href="#_getattribute" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttribute</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>key
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Retrieve a specific attribute for a token by key.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier
- <code>key</code>: Attribute key to retrieve</p>
<p><strong>Returns</strong>: Attribute struct containing key, type, and value</p>
<p><strong>Security</strong>: Prevents access to burned token attributes</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get token rarity attribute</span>
Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>rarityAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>
<span class="w">    </span>attributeStorage<span class="p">.</span>attributes<span class="p">,</span>
<span class="w">    </span>tokenId<span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rarity&quot;</span>
<span class="p">);</span>
console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Token rarity:&quot;</span><span class="p">,</span><span class="w"> </span>rarityAttr<span class="p">.</span>value<span class="p">);</span>
</code></pre></div>

<h4 id="_getattributevalues"><code>_getAttributeValues()</code><a class="headerlink" href="#_getattributevalues" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttributeValues</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Retrieve all attribute values for a token in key order.</p>
<p><strong>Parameters</strong>:
- <code>id</code>: Token identifier</p>
<p><strong>Returns</strong>: Array of attribute values as strings</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttributeValues</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>ct<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">().</span>attributes<span class="p">;</span>
<span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>keys<span class="w"> </span><span class="o">=</span><span class="w"> </span>ct<span class="p">.</span>attributeKeys<span class="p">[</span>id<span class="p">];</span>
<span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>values<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">string</span><span class="p">[](</span>keys<span class="p">.</span>length<span class="p">);</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">keysLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keys<span class="p">.</span>length<span class="p">;</span>
<span class="w">    </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>keysLength<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>values<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ct<span class="p">.</span>attributes<span class="p">[</span>id<span class="p">][</span>keys<span class="p">[</span>i<span class="p">]].</span>value<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>values<span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Use Cases</strong>:
- Metadata generation for NFTs
- Bulk attribute export
- Attribute comparison operations</p>
<h4 id="_getattributekeys"><code>_getAttributeKeys()</code><a class="headerlink" href="#_getattributekeys" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_getAttributeKeys</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span>
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span>
</code></pre></div>

<p><strong>Purpose</strong>: Retrieve all attribute keys for a token.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier</p>
<p><strong>Returns</strong>: Array of attribute keys</p>
<p><strong>Security</strong>: Prevents access to burned token attributes</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Get all attribute keys for a token</span>
<span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>keys<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeKeys<span class="p">(</span>
<span class="w">    </span>attributeStorage<span class="p">.</span>attributes<span class="p">,</span>
<span class="w">    </span>tokenId
<span class="p">);</span>

<span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>keys<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="s2">&quot;Attribute key:&quot;</span><span class="p">,</span><span class="w"> </span>keys<span class="p">[</span>i<span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="attribute-modification">Attribute Modification<a class="headerlink" href="#attribute-modification" title="Permanent link">&para;</a></h3>
<h4 id="_setattribute"><code>_setAttribute()</code><a class="headerlink" href="#_setattribute" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_setAttribute</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">    </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attribute
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span>
</code></pre></div>

<p><strong>Purpose</strong>: Set or update a single attribute for a token.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier
- <code>attribute</code>: Attribute data to set</p>
<p><strong>Process</strong>:
1. Verify token is not burned
2. Check if attribute key is new
3. Add key to keys array if new
4. Update key index mapping
5. Store attribute data</p>
<p><strong>Security</strong>: Prevents modification of burned token attributes</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Set token rarity attribute</span>
Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>rarityAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">    </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;rarity&quot;</span><span class="p">,</span>
<span class="w">    </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">    </span>value<span class="o">:</span><span class="w"> </span><span class="s2">&quot;Legendary&quot;</span>
<span class="p">});</span>

AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>
<span class="w">    </span>attributeStorage<span class="p">.</span>attributes<span class="p">,</span>
<span class="w">    </span>tokenId<span class="p">,</span>
<span class="w">    </span>rarityAttr
<span class="p">);</span>
</code></pre></div>

<h4 id="_setattributes"><code>_setAttributes()</code><a class="headerlink" href="#_setattributes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_setAttributes</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">    </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>_attributes
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span>
</code></pre></div>

<p><strong>Purpose</strong>: Set multiple attributes for a token in a single operation.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier
- <code>_attributes</code>: Array of attributes to set</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_setAttributes</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>_attributes
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>self<span class="p">.</span>burnedIds<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Token has been burned&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">attributesLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_attributes<span class="p">.</span>length<span class="p">;</span>
<span class="w">    </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>attributesLength<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>_setAttribute<span class="p">(</span>self<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>_attributes<span class="p">[</span>i<span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Benefits</strong>:
- Gas efficient for multiple attributes
- Atomic operation for consistency
- Simplified batch updates</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Set multiple attributes at once</span>
Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Attribute<span class="p">[](</span><span class="m m-Decimal">3</span><span class="p">);</span>
attributes<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">(</span><span class="s2">&quot;rarity&quot;</span><span class="p">,</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Epic&quot;</span><span class="p">);</span>
attributes<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span><span class="w"> </span><span class="s2">&quot;25&quot;</span><span class="p">);</span>
attributes<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">(</span><span class="s2">&quot;element&quot;</span><span class="p">,</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Fire&quot;</span><span class="p">);</span>

AttributeLib<span class="p">.</span>_setAttributes<span class="p">(</span>
<span class="w">    </span>attributeStorage<span class="p">.</span>attributes<span class="p">,</span>
<span class="w">    </span>tokenId<span class="p">,</span>
<span class="w">    </span>attributes
<span class="p">);</span>
</code></pre></div>

<h4 id="_removeattribute"><code>_removeAttribute()</code><a class="headerlink" href="#_removeattribute" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_removeAttribute</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>key
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span>
</code></pre></div>

<p><strong>Purpose</strong>: Remove a specific attribute from a token.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier
- <code>key</code>: Attribute key to remove</p>
<p><strong>Process</strong>:
1. Verify token is not burned
2. Delete attribute data
3. Find key index in keys array
4. Shift remaining keys to fill gap
5. Update key indexes
6. Remove last element from array
7. Emit removal event</p>
<p><strong>Security</strong>: Prevents modification of burned token attributes</p>
<p><strong>Example Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Remove temporary attribute</span>
AttributeLib<span class="p">.</span>_removeAttribute<span class="p">(</span>
<span class="w">    </span>attributeStorage<span class="p">.</span>attributes<span class="p">,</span>
<span class="w">    </span>tokenId<span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;temporary_boost&quot;</span>
<span class="p">);</span>
</code></pre></div>

<h3 id="token-lifecycle">Token Lifecycle<a class="headerlink" href="#token-lifecycle" title="Permanent link">&para;</a></h3>
<h4 id="_burn"><code>_burn()</code><a class="headerlink" href="#_burn" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_burn</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span>
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span>
</code></pre></div>

<p><strong>Purpose</strong>: Mark a token as burned to prevent future attribute operations.</p>
<p><strong>Parameters</strong>:
- <code>self</code>: Storage reference to attribute contract
- <code>tokenId</code>: Token identifier to burn</p>
<p><strong>Implementation</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">function</span><span class="w"> </span><span class="nv">_burn</span><span class="p">(</span>
<span class="w">    </span>AttributeContract<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span>
<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>self<span class="p">.</span>burnedIds<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Effects</strong>:
- Prevents all future attribute operations on the token
- Preserves existing attribute data for historical purposes
- Enables gas-efficient burn protection checks</p>
<h2 id="integration-examples">Integration Examples<a class="headerlink" href="#integration-examples" title="Permanent link">&para;</a></h2>
<h3 id="nft-collection-with-dynamic-attributes">NFT Collection with Dynamic Attributes<a class="headerlink" href="#nft-collection-with-dynamic-attributes" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// NFT collection with evolving attributes</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">EvolvingNFT</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>AttributeLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Evolution</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>newAttributes<span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>attributeValues<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>tokenLevels<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>tokenExperience<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Evolution<span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>evolutionPaths<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">TokenEvolved</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newLevel</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ExperienceGained</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">experience</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AttributeEvolved</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">newValue</span><span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">initializeToken</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>initialAttributes<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>initialValues<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>initialAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>initialValues<span class="p">.</span>length<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Arrays length mismatch&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Set initial attributes</span>
<span class="w">        </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Attribute<span class="p">[](</span>initialAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>initialAttributes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>attributes<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">                </span>key<span class="o">:</span><span class="w"> </span>initialAttributes<span class="p">[</span>i<span class="p">],</span>
<span class="w">                </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">                </span>value<span class="o">:</span><span class="w"> </span>initialValues<span class="p">[</span>i<span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Add level and experience</span>
<span class="w">        </span>attributes<span class="p">[</span>initialAttributes<span class="p">.</span>length<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>attributes<span class="p">[</span>initialAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;experience&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttributes<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attributes<span class="p">);</span>

<span class="w">        </span>tokenLevels<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="w">        </span>tokenExperience<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">gainExperience</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">experience</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>experience<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Experience must be positive&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Update experience</span>
<span class="w">        </span>tokenExperience<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>experience<span class="p">;</span>

<span class="w">        </span><span class="c1">// Update experience attribute</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>expAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;experience&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>tokenExperience<span class="p">[</span>tokenId<span class="p">])</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>expAttr<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>ExperienceGained<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>experience<span class="p">);</span>

<span class="w">        </span><span class="c1">// Check for level up</span>
<span class="w">        </span>_checkLevelUp<span class="p">(</span>tokenId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_checkLevelUp</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">currentLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tokenLevels<span class="p">[</span>tokenId<span class="p">];</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">currentExp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tokenExperience<span class="p">[</span>tokenId<span class="p">];</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">requiredExp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>currentLevel<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// Simple formula</span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>currentExp<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>requiredExp<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>currentLevel<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="w">            </span>tokenLevels<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>newLevel<span class="p">;</span>

<span class="w">            </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">            </span><span class="c1">// Update level attribute</span>
<span class="w">            </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>levelAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">                </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">,</span>
<span class="w">                </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">                </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>newLevel<span class="p">)</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>levelAttr<span class="p">);</span>

<span class="w">            </span>emit<span class="w"> </span>TokenEvolved<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>newLevel<span class="p">);</span>

<span class="w">            </span><span class="c1">// Apply evolution changes</span>
<span class="w">            </span>_applyEvolution<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>newLevel<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_applyEvolution</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newLevel</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Evolution<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>evolutions<span class="w"> </span><span class="o">=</span><span class="w"> </span>evolutionPaths<span class="p">[</span>tokenId<span class="p">];</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>evolutions<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>evolutions<span class="p">[</span>i<span class="p">].</span>requiredLevel<span class="w"> </span><span class="o">==</span><span class="w"> </span>newLevel<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">                </span><span class="c1">// Apply evolution attributes</span>
<span class="w">                </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>j<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>evolutions<span class="p">[</span>i<span class="p">].</span>newAttributes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>j<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">                        </span>key<span class="o">:</span><span class="w"> </span>evolutions<span class="p">[</span>i<span class="p">].</span>newAttributes<span class="p">[</span>j<span class="p">],</span>
<span class="w">                        </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">                        </span>value<span class="o">:</span><span class="w"> </span>evolutions<span class="p">[</span>i<span class="p">].</span>attributeValues<span class="p">[</span>j<span class="p">]</span>
<span class="w">                    </span><span class="p">});</span>

<span class="w">                    </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attr<span class="p">);</span>

<span class="w">                    </span>emit<span class="w"> </span>AttributeEvolved<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>evolutions<span class="p">[</span>i<span class="p">].</span>newAttributes<span class="p">[</span>j<span class="p">],</span><span class="w"> </span>evolutions<span class="p">[</span>i<span class="p">].</span>attributeValues<span class="p">[</span>j<span class="p">]);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="kt">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getTokenAttributes</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>keys<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>values<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span>keys<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeKeys<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>
<span class="w">        </span>values<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeValues<span class="p">(</span>tokenId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getAttribute</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>key<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>key<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_exists</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check token existence</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="gaming-item-system">Gaming Item System<a class="headerlink" href="#gaming-item-system" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Gaming items with dynamic stats and upgrades</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">GameItems</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>AttributeLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">ItemType</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">category</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>baseAttributes<span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>baseValues<span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">maxLevel</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">UpgradePath</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">level</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">attribute</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">valueModifier</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">cost</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>ItemType<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>itemTypes<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>UpgradePath<span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>upgradePaths<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>itemTypeIds<span class="p">;</span>
<span class="w">    </span>IERC20<span class="w"> </span><span class="kt">public</span><span class="w"> </span>upgradeToken<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ItemCreated</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">itemTypeId</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ItemUpgraded</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">newValue</span><span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ItemEnchanted</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">enchantment</span><span class="p">);</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_upgradeToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>upgradeToken<span class="w"> </span><span class="o">=</span><span class="w"> </span>IERC20<span class="p">(</span>_upgradeToken<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createItemType</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">itemTypeId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>name<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>category<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>baseAttributes<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>baseValues<span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">maxLevel</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyGameMaster<span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>baseAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>baseValues<span class="p">.</span>length<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Arrays length mismatch&quot;</span><span class="p">);</span>

<span class="w">        </span>itemTypes<span class="p">[</span>itemTypeId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ItemType<span class="p">({</span>
<span class="w">            </span>name<span class="o">:</span><span class="w"> </span>name<span class="p">,</span>
<span class="w">            </span>category<span class="o">:</span><span class="w"> </span>category<span class="p">,</span>
<span class="w">            </span>baseAttributes<span class="o">:</span><span class="w"> </span>baseAttributes<span class="p">,</span>
<span class="w">            </span>baseValues<span class="o">:</span><span class="w"> </span>baseValues<span class="p">,</span>
<span class="w">            </span>maxLevel<span class="o">:</span><span class="w"> </span>maxLevel
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">mintItem</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">itemTypeId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyGameMaster<span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ItemType<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>itemType<span class="w"> </span><span class="o">=</span><span class="w"> </span>itemTypes<span class="p">[</span>itemTypeId<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>itemType<span class="p">.</span>name<span class="p">).</span>length<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Item type does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Mint token (implementation would call ERC721 mint)</span>
<span class="w">        </span>_mint<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>

<span class="w">        </span>itemTypeIds<span class="p">[</span>tokenId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>itemTypeId<span class="p">;</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Set base attributes</span>
<span class="w">        </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Attribute<span class="p">[](</span>itemType<span class="p">.</span>baseAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">);</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>itemType<span class="p">.</span>baseAttributes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>attributes<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">                </span>key<span class="o">:</span><span class="w"> </span>itemType<span class="p">.</span>baseAttributes<span class="p">[</span>i<span class="p">],</span>
<span class="w">                </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">                </span>value<span class="o">:</span><span class="w"> </span>itemType<span class="p">.</span>baseValues<span class="p">[</span>i<span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Add metadata attributes</span>
<span class="w">        </span>attributes<span class="p">[</span>itemType<span class="p">.</span>baseAttributes<span class="p">.</span>length<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;item_type&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>itemType<span class="p">.</span>name
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>attributes<span class="p">[</span>itemType<span class="p">.</span>baseAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;category&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>itemType<span class="p">.</span>category
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>attributes<span class="p">[</span>itemType<span class="p">.</span>baseAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttributes<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attributes<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>ItemCreated<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>itemTypeId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">upgradeItem</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>attribute<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_isApprovedOrOwner<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Not authorized&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Get current level</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>levelAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">currentLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>StringsLib<span class="p">.</span>parseUint<span class="p">(</span>levelAttr<span class="p">.</span>value<span class="p">);</span>

<span class="w">        </span>ItemType<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>itemType<span class="w"> </span><span class="o">=</span><span class="w"> </span>itemTypes<span class="p">[</span>itemTypeIds<span class="p">[</span>tokenId<span class="p">]];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>currentLevel<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>itemType<span class="p">.</span>maxLevel<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Item at max level&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Find upgrade path</span>
<span class="w">        </span>UpgradePath<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>paths<span class="w"> </span><span class="o">=</span><span class="w"> </span>upgradePaths<span class="p">[</span>itemTypeIds<span class="p">[</span>tokenId<span class="p">]];</span>
<span class="w">        </span>UpgradePath<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>upgradePath<span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>paths<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>paths<span class="p">[</span>i<span class="p">].</span>level<span class="w"> </span><span class="o">==</span><span class="w"> </span>currentLevel<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">                </span><span class="nb">keccak256</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>paths<span class="p">[</span>i<span class="p">].</span>attribute<span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>attribute<span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>upgradePath<span class="w"> </span><span class="o">=</span><span class="w"> </span>paths<span class="p">[</span>i<span class="p">];</span>
<span class="w">                </span>found<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">                </span><span class="kt">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span>found<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Upgrade path not found&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Pay upgrade cost</span>
<span class="w">        </span>upgradeToken<span class="p">.</span>transferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"> </span>upgradePath<span class="p">.</span>cost<span class="p">);</span>

<span class="w">        </span><span class="c1">// Apply upgrade</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>currentAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attribute<span class="p">);</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">currentValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>StringsLib<span class="p">.</span>parseUint<span class="p">(</span>currentAttr<span class="p">.</span>value<span class="p">);</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>StringsLib<span class="p">.</span>parseUint<span class="p">(</span>upgradePath<span class="p">.</span>valueModifier<span class="p">);</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>currentValue<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">modifier</span><span class="p">;</span>

<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>newAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span>attribute<span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>currentAttr<span class="p">.</span>attributeType<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>newValue<span class="p">)</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>newAttr<span class="p">);</span>

<span class="w">        </span><span class="c1">// Update level</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>newLevelAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>currentLevel<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>newLevelAttr<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>ItemUpgraded<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>attribute<span class="p">,</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span>newValue<span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">enchantItem</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>enchantment<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>onlyGameMaster<span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>enchantAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span>enchantment<span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>value
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>enchantAttr<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>ItemEnchanted<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>enchantment<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getItemStats</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>values<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>itemType<span class="p">,</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">level</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Token does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeKeys<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>
<span class="w">        </span>values<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeValues<span class="p">(</span>tokenId<span class="p">);</span>

<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>typeAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;item_type&quot;</span><span class="p">);</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>levelAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="p">);</span>

<span class="w">        </span>itemType<span class="w"> </span><span class="o">=</span><span class="w"> </span>typeAttr<span class="p">.</span>value<span class="p">;</span>
<span class="w">        </span>level<span class="w"> </span><span class="o">=</span><span class="w"> </span>StringsLib<span class="p">.</span>parseUint<span class="p">(</span>levelAttr<span class="p">.</span>value<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">burnItem</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_isApprovedOrOwner<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Not authorized&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>
<span class="w">        </span>AttributeLib<span class="p">.</span>_burn<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>

<span class="w">        </span><span class="c1">// Burn token (implementation would call ERC721 burn)</span>
<span class="w">        </span>_burn<span class="p">(</span>tokenId<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_mint</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would mint ERC721 token</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_burn</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would burn ERC721 token</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_exists</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check token existence</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_isApprovedOrOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check authorization</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyGameMaster<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check game master role</span>
<span class="w">        </span>_<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="certificate-system-with-verifiable-attributes">Certificate System with Verifiable Attributes<a class="headerlink" href="#certificate-system-with-verifiable-attributes" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Certificate system with verifiable attributes</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">VerifiableCertificates</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>using<span class="w"> </span>AttributeLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="p">;</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">CertificateTemplate</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span>requiredAttributes<span class="p">;</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">issuer</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">active</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Verification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">verifier</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">verified</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">notes</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>CertificateTemplate<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>certificateTemplates<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Verification<span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>verifications<span class="p">;</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>authorizedVerifiers<span class="p">;</span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">CertificateIssued</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">template</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>recipient<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AttributeVerified</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>verifier<span class="p">);</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">VerificationAdded</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>verifier<span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">verified</span><span class="p">);</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createCertificateTemplate</span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>requiredAttributes
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>certificateTemplates<span class="p">[</span>templateName<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CertificateTemplate<span class="p">({</span>
<span class="w">            </span>name<span class="o">:</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">            </span>requiredAttributes<span class="o">:</span><span class="w"> </span>requiredAttributes<span class="p">,</span>
<span class="w">            </span>issuer<span class="o">:</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span>
<span class="w">            </span>active<span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">issueCertificate</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>templateName<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributeValues
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>CertificateTemplate<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>template<span class="w"> </span><span class="o">=</span><span class="w"> </span>certificateTemplates<span class="p">[</span>templateName<span class="p">];</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>template<span class="p">.</span>active<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Template not active&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>template<span class="p">.</span>issuer<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not authorized issuer&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>attributeValues<span class="p">.</span>length<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Attributes length mismatch&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Mint certificate token</span>
<span class="w">        </span>_mint<span class="p">(</span>recipient<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span><span class="c1">// Set certificate attributes</span>
<span class="w">        </span>Attribute<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Attribute<span class="p">[](</span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">);</span>

<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>attributes<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">                </span>key<span class="o">:</span><span class="w"> </span>template<span class="p">.</span>requiredAttributes<span class="p">[</span>i<span class="p">],</span>
<span class="w">                </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">                </span>value<span class="o">:</span><span class="w"> </span>attributeValues<span class="p">[</span>i<span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Add metadata</span>
<span class="w">        </span>attributes<span class="p">[</span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;template&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>templateName
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>attributes<span class="p">[</span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;issuer&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>String<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toHexString<span class="p">(</span><span class="kt">uint160</span><span class="p">(</span>template<span class="p">.</span>issuer<span class="p">),</span><span class="w"> </span><span class="m m-Decimal">20</span><span class="p">)</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>attributes<span class="p">[</span>template<span class="p">.</span>requiredAttributes<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;issue_date&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span><span class="k">block.timestamp</span><span class="p">)</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttributes<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attributes<span class="p">);</span>

<span class="w">        </span>emit<span class="w"> </span>CertificateIssued<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span>templateName<span class="p">,</span><span class="w"> </span>recipient<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">addVerification</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">verified</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>notes
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>authorizedVerifiers<span class="p">[</span><span class="k">msg.sender</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;Not authorized verifier&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Certificate does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>verifications<span class="p">[</span>tokenId<span class="p">].</span>push<span class="p">(</span>Verification<span class="p">({</span>
<span class="w">            </span>verifier<span class="o">:</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span>
<span class="w">            </span>timestamp<span class="o">:</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">,</span>
<span class="w">            </span>verified<span class="o">:</span><span class="w"> </span>verified<span class="p">,</span>
<span class="w">            </span>notes<span class="o">:</span><span class="w"> </span>notes
<span class="w">        </span><span class="p">}));</span>

<span class="w">        </span>emit<span class="w"> </span>VerificationAdded<span class="p">(</span>tokenId<span class="p">,</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>verified<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">verifyAttribute</span><span class="p">(</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>attribute<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>expectedValue
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Certificate does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>attribute<span class="p">);</span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>attr<span class="p">.</span>value<span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>expectedValue<span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getCertificateData</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>attributes<span class="p">,</span>
<span class="w">        </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>values<span class="p">,</span>
<span class="w">        </span>Verification<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>certificateVerifications
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Certificate does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>

<span class="w">        </span>attributes<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeKeys<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">);</span>
<span class="w">        </span>values<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttributeValues<span class="p">(</span>tokenId<span class="p">);</span>
<span class="w">        </span>certificateVerifications<span class="w"> </span><span class="o">=</span><span class="w"> </span>verifications<span class="p">[</span>tokenId<span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">revokeCertificate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_exists<span class="p">(</span>tokenId<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Certificate does not exist&quot;</span><span class="p">);</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>AttributeStorage<span class="w"> </span>storage<span class="w"> </span>attrStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>attributeStorage<span class="p">();</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>issuerAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>AttributeLib<span class="p">.</span>_getAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span><span class="s2">&quot;issuer&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">issuer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>parseAddress<span class="p">(</span>issuerAttr<span class="p">.</span>value<span class="p">);</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>issuer<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not authorized&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Add revocation attribute</span>
<span class="w">        </span>Attribute<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>revokedAttr<span class="w"> </span><span class="o">=</span><span class="w"> </span>Attribute<span class="p">({</span>
<span class="w">            </span>key<span class="o">:</span><span class="w"> </span><span class="s2">&quot;revoked&quot;</span><span class="p">,</span>
<span class="w">            </span>attributeType<span class="o">:</span><span class="w"> </span>AttributeType<span class="p">.</span>Uint256<span class="p">,</span>
<span class="w">            </span>value<span class="o">:</span><span class="w"> </span>Strings<span class="p">.</span>toString<span class="p">(</span><span class="k">block.timestamp</span><span class="p">)</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span>AttributeLib<span class="p">.</span>_setAttribute<span class="p">(</span>attrStorage<span class="p">.</span>attributes<span class="p">,</span><span class="w"> </span>tokenId<span class="p">,</span><span class="w"> </span>revokedAttr<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">parseAddress</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>addressString<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would parse hex string to address</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_mint</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would mint ERC721 token</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_exists</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Implementation would check token existence</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<h3 id="attribute-events">Attribute Events<a class="headerlink" href="#attribute-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kt">event</span><span class="w"> </span><span class="nv">AttributeSet</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenAddress<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span>Attribute<span class="w"> </span>attribute<span class="p">);</span>
<span class="kt">event</span><span class="w"> </span><span class="nv">AttributeRemoved</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>tokenAddress<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">tokenId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">attributeKey</span><span class="p">);</span>
</code></pre></div>

<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<h3 id="burn-protection">Burn Protection<a class="headerlink" href="#burn-protection" title="Permanent link">&para;</a></h3>
<ul>
<li>All attribute operations check burn status</li>
<li>Prevents modification of burned token attributes</li>
<li>Preserves historical data for burned tokens</li>
<li>Efficient burn status checking</li>
</ul>
<h3 id="access-control">Access Control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h3>
<ul>
<li>No built-in access control (delegated to calling contracts)</li>
<li>Calling contracts must implement proper authorization</li>
<li>Event emission for audit trails</li>
</ul>
<h3 id="access-control_1">Access Control<a class="headerlink" href="#access-control_1" title="Permanent link">&para;</a></h3>
<ul>
<li>No built-in access control (delegated to calling contracts)</li>
<li>Calling contracts must implement proper authorization</li>
<li>Event emission for audit trails</li>
<li>Attribute modification requires proper token ownership validation</li>
</ul>
<h3 id="data-integrity">Data Integrity<a class="headerlink" href="#data-integrity" title="Permanent link">&para;</a></h3>
<ul>
<li>Type information preserved for proper value interpretation</li>
<li>String storage for all values ensures consistency</li>
<li>Key uniqueness enforced within token scope</li>
<li>Efficient indexing for key management</li>
</ul>
<h2 id="gas-optimization">Gas Optimization<a class="headerlink" href="#gas-optimization" title="Permanent link">&para;</a></h2>
<h3 id="storage-efficiency">Storage Efficiency<a class="headerlink" href="#storage-efficiency" title="Permanent link">&para;</a></h3>
<ul>
<li>Optimized key-value storage with indexing</li>
<li>Minimal storage writes during attribute operations</li>
<li>Efficient key removal with array compaction</li>
<li>Batch operations for multiple attributes</li>
</ul>
<h3 id="function-efficiency">Function Efficiency<a class="headerlink" href="#function-efficiency" title="Permanent link">&para;</a></h3>
<ul>
<li>Direct storage access without external calls</li>
<li>Efficient key lookup using index mapping</li>
<li>Minimal gas overhead for attribute operations</li>
<li>Optimized loops for batch operations</li>
</ul>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="common-errors">Common Errors<a class="headerlink" href="#common-errors" title="Permanent link">&para;</a></h3>
<ul>
<li>"Token has been burned" - Attempt to modify burned token attributes</li>
<li>Array length mismatches in batch operations</li>
<li>Invalid token IDs or non-existent tokens</li>
<li>Unauthorized attribute modifications</li>
</ul>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li>Always validate token existence before operations</li>
<li>Check burn status before attribute modifications</li>
<li>Implement proper access control in calling contracts</li>
<li>Use batch operations for multiple attributes</li>
<li>Handle missing attributes gracefully</li>
</ul>
<h2 id="testing-considerations">Testing Considerations<a class="headerlink" href="#testing-considerations" title="Permanent link">&para;</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Attribute setting and retrieval</li>
<li>Batch attribute operations</li>
<li>Key management and indexing</li>
<li>Burn protection functionality</li>
<li>Event emission verification</li>
</ul>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Cross-contract attribute usage</li>
<li>NFT metadata integration</li>
<li>Gaming system attribute evolution</li>
<li>Certificate verification workflows</li>
<li>Attribute-based access control</li>
</ul>
<h3 id="edge-cases">Edge Cases<a class="headerlink" href="#edge-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>Empty attribute values</li>
<li>Maximum key length handling</li>
<li>Large attribute arrays</li>
<li>Concurrent attribute modifications</li>
<li>Burn state transitions</li>
</ul>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../interfaces/iattribute/">IAttribute Interface</a> - Attribute interface definition</li>
<li><a href="../facets/attribute-facet.md">AttributeFacet</a> - Attribute facet implementation</li>
<li><a href="../../guides/erc721-attributes.md">ERC721 Integration</a> - NFT attribute integration</li>
<li><a href="../../guides/gaming-attributes.md">Gaming Attributes Guide</a> - Gaming system attribute patterns</li>
<li><a href="../../guides/metadata-standards.md">Metadata Standards</a> - Attribute metadata best practices</li>
</ul>
<hr />
<p><em>This library provides comprehensive utilities for managing dynamic token attributes within the Gemforce platform, supporting typed metadata, efficient storage, and flexible attribute systems for NFTs, gaming items, certificates, and other tokenized assets.</em></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../svg-templates-lib/" class="btn btn-neutral float-left" title="SVG Templates Lib"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../variable-price-lib/" class="btn btn-neutral float-right" title="Variable Price Lib">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../svg-templates-lib/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../variable-price-lib/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
