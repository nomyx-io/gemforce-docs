<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gemforce Team" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Sample Code - Gemforce Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Sample Code";
        var mkdocs_page_input_path = "integrator-guide/sample-code.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Gemforce Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../developer-setup-guide/">Developer Setup Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../system-architecture/gemforce-system-architecture/">System Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Contracts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../smart-contracts/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../smart-contracts/diamond/">Diamond Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../smart-contracts/diamond-factory/">Diamond Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../smart-contracts/identity-factory/">Identity Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Facets</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/marketplace-facet/">Marketplace Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/trade-deal-management-facet/">Trade Deal Management Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/carbon-credit-facet/">Carbon Credit Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/identity-registry-facet/">Identity Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/trusted-issuers-registry-facet/">Trusted Issuers Registry Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/fee-distributor-facet/">Fee Distributor Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/gemforce-minter-facet/">Gemforce Minter Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/multi-sale-facet/">Multi Sale Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/svg-templates-facet/">SVG Templates Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/trade-deal-admin-facet/">Trade Deal Admin Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/trade-deal-operations-facet/">Trade Deal Operations Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/collateral-token-factory-facet/">Collateral Token Factory Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/diamond-cut-facet/">Diamond Cut Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/diamond-loupe-facet/">Diamond Loupe Facet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/facets/ownership-facet/">Ownership Facet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Interfaces</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/idiamond/">IDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/imarketplace/">IMarketplace</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/itradedeal/">ITradeDeal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/icarbon-credit/">ICarbonCredit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ierc1155-mint/">IERC1155Mint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ierc734/">IERC734</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ierc735/">IERC735</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ierc721a/">IERC721A</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/idiamond-factory/">IDiamondFactory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/iidentity/">IIdentity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/imultisale/">IMultiSale</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ifee-distributor/">IFeeDistributor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/igemforce-minter-facet/">IGemforceMinterFacet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/iidentity-registry/">IIdentityRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/itrusted-issuers-registry/">TRUSTEDIssuersRegistry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/isvg/">ISVG</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/iattribute/">IAttribute</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/interfaces/ivariable-price/">IVariablePrice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Libraries</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/carbon-credit-lib/">Carbon Credit Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/trade-deal-lib/">Trade Deal Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/multi-sale-lib/">Multi Sale Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/diamond-factory-lib/">Diamond Factory Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/svg-templates-lib/">SVG Templates Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/attribute-lib/">Attribute Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/variable-price-lib/">Variable Price Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/merkle-prover/">Merkle Prover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/fee-distributor-lib/">Fee Distributor Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/lib-diamond/">LibDiamond</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/diamond-lib/">DiamondLib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/erc721a-lib/">ERC721A Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/erc721a-enumeration-lib/">ERC721A Enumeration Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/strings-lib/">Strings Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/trusted-issuer-lib/">Trusted Issuer Lib</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../smart-contracts/libraries/set-libraries/">Set Libraries</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SDK & Libraries</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/blockchain/">Blockchain Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/diamond/">Diamond Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/contract/">Contract Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/deploy/">Deployment Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/validation-utils/">Validation Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/nft-sale-utils/">NFT Sale Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sdk-libraries/webhooks/">Webhooks Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../smart-contracts/libraries/metadata-lib/">Metadata Library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Functions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/authentication/">Authentication Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/auth-functions/">Auth Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/blockchain/">Blockchain Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/bridge/">Bridge Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/contracts/">Contract Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/deploy/">Deploy Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/dfns/">DFNS Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/project/">Project Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/trade-deal/">Trade Deal Functions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-documentation/gemforce-api-documentation/">Full API Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-documentation/gemforce-api-quick-reference/">Quick Reference</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../gemforce-external-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../gemforce-system-architecture/">System Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Operations Tasks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/diamond/">Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/identities/">Identity Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/marketplace-management/">Marketplace Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/carbon-credit-management/">Carbon Credit Management Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/trade-deal/">Trade Deal Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/integration-test/">Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/integration-test-marketplace/">Marketplace Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/integration-test-trade-deal/">Trade Deal Integration Test Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/admin-utils/">Admin Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/sync-diamond/">Sync Diamond Tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cloud-functions/tasks/sync-events/">Sync Events Tasks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">EIPs (Ethereum Improvement Proposals)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Diamond-Enhanced-Marketplace/">Diamond-Enhanced Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Multi-Token-Sale-Standard/">Multi-Token Sale Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Collateralized-Trade-Deal-Standard/">Collateralized Trade Deal Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Enhanced-Identity-System/">Enhanced Identity System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Diamond-Factory-Standard/">Diamond Factory Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../eips/EIP-DRAFT-Carbon-Credit-Standard/">Carbon Credit Standard</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/development-environment-setup/">Development Environment Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/testing-frameworks/">Testing Frameworks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/performance-optimization/">Performance Optimization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/test-case-specifications/">Test Case Specifications</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/test-data-management/">Test Data Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guides/automated-testing-setup/">Automated Testing Setup</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../deployment-guides/multi-network-deployment/">Multi-Network Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../deployment-guides/infrastructure-management/">Infrastructure Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../deployment-guides/monitoring-logging/">Monitoring and Logging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../gemforce-administrator-guide/">Administrator Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gemforce-deployer-guide/">Deployer Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gemforce-integrator-guide/">Integrator Guide</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Integrator's Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rest-api/">REST API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../smart-contracts/">Smart Contracts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dfns/">DFNS Integration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../parse-server/">Parse Server Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../webhooks/">Webhooks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../error-handling/">Error Handling</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Sample Code</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview-of-sample-code">Overview of Sample Code</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#1-smart-contract-interaction-examples">1. Smart Contract Interaction Examples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#11-deploying-a-diamond-contract-using-hardhatethersjs">1.1 Deploying a Diamond Contract (using Hardhat/Ethers.js)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#12-interacting-with-marketplace-listing-frontend-ethersjs">1.2 Interacting with Marketplace Listing (Frontend Ethers.js)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#13-listening-for-smart-contract-events-backend-nodejs">1.3 Listening for Smart Contract Events (Backend Node.js)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-cloud-function-rest-api-usage-examples">2. Cloud Function &amp; REST API Usage Examples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#21-user-authentication-frontend-javascript">2.1 User Authentication (Frontend JavaScript)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#22-managing-a-custom-object-nodejs-backend">2.2 Managing a Custom Object (Node.js Backend)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-advanced-integration-examples">3. Advanced Integration Examples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-dfns-transaction-signing-backend-nodejs">3.1 DFNS Transaction Signing (Backend Node.js)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-consuming-a-webhook-nodejs-with-express">3.2 Consuming a Webhook (Node.js with Express)</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../integration-patterns/">Integration Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/">Testing Considerations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../external-services/gemforce-external-services/">External Services</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/threat-model/">Threat Model and Risk Assessment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/incident-response/">Incident Response Procedures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/audit-compliance/">Security Audits and Compliance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">External Developer Integration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../external-developer-integration/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../external-developer-integration/api-rate-limiting/">API Rate Limiting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../external-developer-integration/webhook-implementation-guidelines/">Webhook Implementation Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../external-developer-integration/sdk-development-guidelines/">SDK Development Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../external-developer-integration/partner-integration-guides/">Partner Integration Guides</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../gemforce-documentation-gap-analysis/">Documentation Gap Analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../documentation-progress-summary/">Documentation Progress Summary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../documentation-plan/">Documentation Plan</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Configuration & Environment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/gemforce-config/">Gemforce Config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/environment-specific-guides/">Environment-Specific Guides</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/configuration-validation/">Configuration Validation Procedures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/external-service-config-management/">External Service Configuration Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/database-schema-overview/">Database Schema Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration-environment/database-migration-procedures/">Database Migration Procedures</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Gemforce Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Integrator's Guide</li>
      <li class="breadcrumb-item active">Sample Code</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="integrators-guide-sample-code">Integrator's Guide: Sample Code<a class="headerlink" href="#integrators-guide-sample-code" title="Permanent link">&para;</a></h1>
<p>This section provides practical code samples and snippets to help you quickly get started with integrating your applications with the Gemforce platform. The examples cover common use cases and demonstrate how to interact with various Gemforce components, including smart contracts, cloud functions, and APIs.</p>
<h2 id="overview-of-sample-code">Overview of Sample Code<a class="headerlink" href="#overview-of-sample-code" title="Permanent link">&para;</a></h2>
<p>The samples are categorized by the Gemforce component they demonstrate:</p>
<ul>
<li><strong>Smart Contract Interaction</strong>: Examples for deploying, calling functions, and listening to events on Gemforce's Diamond contracts.</li>
<li><strong>Cloud Function &amp; REST API Usage</strong>: Demonstrations of user authentication, data management (CRUD), and invoking custom cloud logic.</li>
<li><strong>Advanced Integrations</strong>: Code for features like DFNS transaction signing, webhook handling, and data analytics.</li>
</ul>
<p>Each example is designed to be self-contained where possible, but you may need to refer to other sections of this Integrator's Guide for full context (e.g., <a href="../authentication/">Authentication</a>, <a href="../smart-contracts/">Smart Contracts</a>).</p>
<h2 id="1-smart-contract-interaction-examples">1. Smart Contract Interaction Examples<a class="headerlink" href="#1-smart-contract-interaction-examples" title="Permanent link">&para;</a></h2>
<h3 id="11-deploying-a-diamond-contract-using-hardhatethersjs">1.1 Deploying a Diamond Contract (using Hardhat/Ethers.js)<a class="headerlink" href="#11-deploying-a-diamond-contract-using-hardhatethersjs" title="Permanent link">&para;</a></h3>
<p>This example shows a simplified Hardhat script to deploy a Gemforce-style Diamond contract with some initial facets.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// scripts/deployDiamond.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ethers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hardhat&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FacetCutAction</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;../@gemforce-sdk/hardhat-diamond/types&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assuming SDK provides this enum</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">deployGemforceDiamond</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">deployer</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Deploying contracts with the account: </span><span class="si">${</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Deploy LibDiamond</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">LibDiamond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&quot;LibDiamond&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">libDiamond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">LibDiamond</span><span class="p">.</span><span class="nx">deploy</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">libDiamond</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`LibDiamond deployed to: </span><span class="si">${</span><span class="nx">libDiamond</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Deploy Diamond</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">Diamond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&quot;Diamond&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">libraries</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">LibDiamond</span><span class="o">:</span><span class="w"> </span><span class="kt">libDiamond.address</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diamond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Diamond</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// initial owner, whether to add owner as facet</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">diamond</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Gemforce Diamond deployed to: </span><span class="si">${</span><span class="nx">diamond</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Deploy Facets</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">FacetA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&quot;FacetA&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">facetA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">FacetA</span><span class="p">.</span><span class="nx">deploy</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">facetA</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`FacetA deployed to: </span><span class="si">${</span><span class="nx">facetA</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">FacetB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&quot;FacetB&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">facetB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">FacetB</span><span class="p">.</span><span class="nx">deploy</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">facetB</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`FacetB deployed to: </span><span class="si">${</span><span class="nx">facetB</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get DiamondCutFacet and DiamondLoupeFacet (assuming they are part of the Diamond initially or deployed separately)</span>
<span class="w">    </span><span class="c1">// For simplicity, let&#39;s assume Diamond.sol contains basic DiamondCutFacet functions or these are injected</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">DiamondCutFacet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&quot;DiamondCutFacet&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diamondCutFacet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">DiamondCutFacet</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">diamond</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Prepare facet cuts</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">facetCuts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">facetAddress</span><span class="o">:</span><span class="w"> </span><span class="kt">facetA.address</span><span class="p">,</span>
<span class="w">            </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">FacetCutAction.Add</span><span class="p">,</span>
<span class="w">            </span><span class="nx">functionSelectors</span><span class="o">:</span><span class="w"> </span><span class="kt">FacetA.interface.getSighash</span><span class="p">(</span><span class="s2">&quot;function1()&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Example selector</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">facetAddress</span><span class="o">:</span><span class="w"> </span><span class="kt">facetB.address</span><span class="p">,</span>
<span class="w">            </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">FacetCutAction.Add</span><span class="p">,</span>
<span class="w">            </span><span class="nx">functionSelectors</span><span class="o">:</span><span class="w"> </span><span class="kt">FacetB.interface.getSighash</span><span class="p">(</span><span class="s2">&quot;function2()&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Example selector</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Perform the diamond cut to add facets</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Adding facets to Diamond...&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">diamondCutTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">diamondCutFacet</span><span class="p">.</span><span class="nx">diamondCut</span><span class="p">(</span>
<span class="w">        </span><span class="nx">facetCuts</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">AddressZero</span><span class="p">,</span><span class="w"> </span><span class="c1">// initContract</span>
<span class="w">        </span><span class="s2">&quot;0x&quot;</span><span class="w"> </span><span class="c1">// initData</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">diamondCutTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Facets added to Diamond.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">diamond</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Call the deployment function</span>
<span class="c1">// deployGemforceDiamond()</span>
<span class="c1">//     .then((address) =&gt; console.log(`Deployment complete. Diamond address: ${address}`))</span>
<span class="c1">//     .catch((error) =&gt; {</span>
<span class="c1">//         console.error(error);</span>
<span class="c1">//         process.exit(1);</span>
<span class="c1">//     });</span>
</code></pre></div>

<h3 id="12-interacting-with-marketplace-listing-frontend-ethersjs">1.2 Interacting with Marketplace Listing (Frontend Ethers.js)<a class="headerlink" href="#12-interacting-with-marketplace-listing-frontend-ethersjs" title="Permanent link">&para;</a></h3>
<p>This example shows how a frontend dApp user might list an ERC721 NFT on the Gemforce marketplace.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// frontend/src/components/ListNFT.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ethers</span><span class="p">,</span><span class="w"> </span><span class="nx">Contract</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">MarketplaceFacetABI</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../abi/MarketplaceFacet.json&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ABI</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ERC721ABI</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../abi/ERC721.json&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ERC721 ABI for approval</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">GEMFORCE_DIAMOND_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0x...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Replace with your deployed Diamond address</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">MARKETPLACE_FACET_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">GEMFORCE_DIAMOND_ADDRESS</span><span class="p">;</span><span class="w"> </span><span class="c1">// Interact via the Diamond address</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">WETH_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0x...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Example WETH address for payment token</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ListNFT</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">nftContractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">setNftContractAddress</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tokenId</span><span class="p">,</span><span class="w"> </span><span class="nx">setTokenId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">setPrice</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">setMessage</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">connectWallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="s2">&quot;MetaMask or compatible wallet not detected.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;eth_requestAccounts&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">Web3Provider</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">getSigner</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleListNFT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="nx">setMessage</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">connectWallet</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">signer</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">nftContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Contract</span><span class="p">(</span><span class="nx">nftContractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">ERC721ABI</span><span class="p">,</span><span class="w"> </span><span class="nx">signer</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">marketplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Contract</span><span class="p">(</span><span class="nx">MARKETPLACE_FACET_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="nx">MarketplaceFacetABI</span><span class="p">,</span><span class="w"> </span><span class="nx">signer</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// 1. Approve the Marketplace Facet to transfer the NFT</span>
<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="s2">&quot;Approving NFT transfer...&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">approveTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">nftContract</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span><span class="nx">MARKETPLACE_FACET_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="nx">tokenId</span><span class="p">);</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">approveTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="sb">`Approval successful. Tx: </span><span class="si">${</span><span class="nx">approveTx</span><span class="p">.</span><span class="nx">hash</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// 2. List the NFT on the marketplace</span>
<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="s2">&quot;Listing NFT on marketplace...&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// Use ethers.utils.parseEther for values in ETH; otherwise convert to Wei</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">priceInWei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">listTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">marketplace</span><span class="p">.</span><span class="nx">listItem</span><span class="p">(</span>
<span class="w">                </span><span class="nx">nftContractAddress</span><span class="p">,</span>
<span class="w">                </span><span class="nx">tokenId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">priceInWei</span><span class="p">,</span>
<span class="w">                </span><span class="nx">WETH_ADDRESS</span><span class="w"> </span><span class="c1">// Or ethers.constants.AddressZero for native ETH</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">listTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>

<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="sb">`NFT listed successfully! Tx: </span><span class="si">${</span><span class="nx">listTx</span><span class="p">.</span><span class="nx">hash</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">setNftContractAddress</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">setTokenId</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">setPrice</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error listing NFT:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">            </span><span class="nx">setMessage</span><span class="p">(</span><span class="sb">`Error: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;Something went wrong.&quot;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">NFT</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">Gemforce</span><span class="w"> </span><span class="nx">Marketplace</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">input</span>
<span class="w">                </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span>
<span class="w">                </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;NFT Contract Address&quot;</span>
<span class="w">                </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">nftContractAddress</span><span class="p">}</span>
<span class="w">                </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setNftContractAddress</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">input</span>
<span class="w">                </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span>
<span class="w">                </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Token ID&quot;</span>
<span class="w">                </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">tokenId</span><span class="p">}</span>
<span class="w">                </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTokenId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">input</span>
<span class="w">                </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span>
<span class="w">                </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Price (ETH)&quot;</span>
<span class="w">                </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">price</span><span class="p">}</span>
<span class="w">                </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setPrice</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleListNFT</span><span class="p">}</span><span class="w"> </span><span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">loading</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="p">{</span><span class="nx">loading</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Processing...&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;List NFT&#39;</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">message</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">ListNFT</span><span class="p">;</span>
</code></pre></div>

<h3 id="13-listening-for-smart-contract-events-backend-nodejs">1.3 Listening for Smart Contract Events (Backend Node.js)<a class="headerlink" href="#13-listening-for-smart-contract-events-backend-nodejs" title="Permanent link">&para;</a></h3>
<p>This Node.js example demonstrates how a backend service can listen for <code>TradeDealCreated</code> events from the <code>TradeDealManagementFacet</code> of the Gemforce Diamond.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// backend/src/listeners/tradeDealListener.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ethers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">TradeDealManagementFacetABI</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../abi/TradeDealManagementFacet.json&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ABI</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">GEMFORCE_DIAMOND_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0x...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Replace with your deployed Diamond address</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RPC_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;wss://base-sepolia.public.blastapi.io&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Use a WebSocket provider for real-time events</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">setupTradeDealListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">WebSocketProvider</span><span class="p">(</span><span class="nx">RPC_URL</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Create a contract instance focused on the TradeDealManagementFacet&#39;s events</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">tradeDealManagement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span>
<span class="w">            </span><span class="nx">GEMFORCE_DIAMOND_ADDRESS</span><span class="p">,</span>
<span class="w">            </span><span class="nx">TradeDealManagementFacetABI</span><span class="p">,</span>
<span class="w">            </span><span class="nx">provider</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Listening for &#39;TradeDealCreated&#39; events...&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Event signature: event TradeDealCreated(bytes32 indexed tradeDealId, address indexed creator, uint256 indexed amount, address assetToken);</span>
<span class="w">        </span><span class="nx">tradeDealManagement</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;TradeDealCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">tradeDealId</span><span class="p">,</span><span class="w"> </span><span class="nx">creator</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">assetToken</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;\n--- New Trade Deal Created! ---&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Trade Deal ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tradeDealId</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Creator:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">creator</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Amount:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">amount</span><span class="p">));</span><span class="w"> </span><span class="c1">// Assuming amount in Wei</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Asset Token:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">assetToken</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Transaction Hash:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">transactionHash</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;-------------------------------&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Here, you would typically:</span>
<span class="w">            </span><span class="c1">// - Update your backend database (e.g., save the new trade deal)</span>
<span class="w">            </span><span class="c1">// - Trigger notifications (e.g., push notification to users)</span>
<span class="w">            </span><span class="c1">// - Initiate further off-chain processing</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error setting up Trade Deal listener:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Start the listener when the application boots up</span>
<span class="c1">// setupTradeDealListener();</span>
</code></pre></div>

<h2 id="2-cloud-function-rest-api-usage-examples">2. Cloud Function &amp; REST API Usage Examples<a class="headerlink" href="#2-cloud-function-rest-api-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="21-user-authentication-frontend-javascript">2.1 User Authentication (Frontend JavaScript)<a class="headerlink" href="#21-user-authentication-frontend-javascript" title="Permanent link">&para;</a></h3>
<p>This example demonstrates user signup and login using direct Parse REST API calls in a web browser.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// frontend/src/services/authService.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PARSE_SERVER_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;YOUR_GEMFORCE_PARSE_SERVER_URL/parse&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">APP_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;YOUR_PARSE_APP_ID&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">CLIENT_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;YOUR_PARSE_CLIENT_KEY&quot;</span><span class="p">;</span><span class="w"> </span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">signUpUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">PARSE_SERVER_URL</span><span class="si">}</span><span class="sb">/users`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-Application-Id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">APP_ID</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-REST-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">CLIENT_KEY</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;Signup failed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User signed up:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span><span class="w"> </span><span class="c1">// Contains sessionToken</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Signup error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">loginUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">PARSE_SERVER_URL</span><span class="si">}</span><span class="sb">/login?username=</span><span class="si">${</span><span class="nx">username</span><span class="si">}</span><span class="sb">&amp;password=</span><span class="si">${</span><span class="nx">password</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-Application-Id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">APP_ID</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-REST-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">CLIENT_KEY</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;Login failed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User logged in, session token:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">sessionToken</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Store sessionToken securely (e.g., localStorage, secure cookies)</span>
<span class="w">        </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;sessionToken&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">sessionToken</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">sessionToken</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Login error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">callAuthenticatedCloudFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">functionName</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;sessionToken&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">sessionToken</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;No active session token found.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">PARSE_SERVER_URL</span><span class="si">}</span><span class="sb">/functions/</span><span class="si">${</span><span class="nx">functionName</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-Application-Id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">APP_ID</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-REST-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">CLIENT_KEY</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;X-Parse-Session-Token&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">sessionToken</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="sb">`Cloud function </span><span class="si">${</span><span class="nx">functionName</span><span class="si">}</span><span class="sb"> failed`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Cloud function </span><span class="si">${</span><span class="nx">functionName</span><span class="si">}</span><span class="sb"> result:`</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Cloud function call error for </span><span class="si">${</span><span class="nx">functionName</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Example usage:</span>
<span class="c1">// (async () =&gt; {</span>
<span class="c1">//     try {</span>
<span class="c1">//         // await signUpUser(&quot;sample_user&quot;, &quot;secure_password&quot;, &quot;user@example.com&quot;);</span>
<span class="c1">//         const token = await loginUser(&quot;sample_user&quot;, &quot;secure_password&quot;);</span>
<span class="c1">//         const result = await callAuthenticatedCloudFunction(&quot;getUserProfile&quot;, { userId: &quot;someUserId&quot; });</span>
<span class="c1">//     } catch (e) {</span>
<span class="c1">//         console.error(&quot;Auth/Cloud Function Demo Error:&quot;, e.message);</span>
<span class="c1">//     }</span>
<span class="c1">// })();</span>
</code></pre></div>

<h3 id="22-managing-a-custom-object-nodejs-backend">2.2 Managing a Custom Object (Node.js Backend)<a class="headerlink" href="#22-managing-a-custom-object-nodejs-backend" title="Permanent link">&para;</a></h3>
<p>This Node.js example demonstrates CRUD operations for a custom Parse <code>Product</code> class using the Parse SDK directly.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// backend/src/services/productService.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;parse/node&#39;</span><span class="p">);</span>

<span class="c1">// Ensure Parse SDK is initialized (e.g., in your app&#39;s entry point)</span>
<span class="c1">// Parse.initialize(&quot;YOUR_PARSE_APP_ID&quot;, &quot;YOUR_PARSE_JAVASCRIPT_KEY&quot;, &quot;YOUR_PARSE_MASTER_KEY&quot;);</span>
<span class="c1">// Parse.serverURL = &quot;YOUR_GEMFORCE_PARSE_SERVER_URL/parse&quot;;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Product&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Product</span><span class="p">();</span>
<span class="w">        </span><span class="nx">product</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="nx">product</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">);</span>
<span class="w">        </span><span class="nx">product</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="p">);</span>
<span class="w">        </span><span class="nx">product</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isInStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Save the object, using Master Key for backend operations</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;New product created with objectId: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">savedProduct</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">savedProduct</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error creating product:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">objectId</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Product&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">Product</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Use Master Key for backend operations</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">objectId</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Retrieved product:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">product</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error getting product:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">objectId</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Product&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">Product</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">objectId</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Retrieve first</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">product</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">updates</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Save updates</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatedProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Product updated:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedProduct</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">updatedProduct</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error updating product:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deleteProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">objectId</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Product&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">Product</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">objectId</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span><span class="w"> </span><span class="nx">useMasterKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Product deleted successfully.&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error deleting product:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Example Usage:</span>
<span class="c1">// (async () =&gt; {</span>
<span class="c1">//     try {</span>
<span class="c1">//         const newProduct = await createProduct(&quot;Gemstone&quot;, &quot;Rare blue sapphire&quot;, 5000);</span>
<span class="c1">//         const productId = newProduct.id;</span>
<span class="c1">//         await getProduct(productId);</span>
<span class="c1">//         await updateProduct(productId, { price: 4500, isInStock: false });</span>
<span class="c1">//         await deleteProduct(productId);</span>
<span class="c1">//     } catch (e) {</span>
<span class="c1">//         console.error(&quot;Product Service Demo Error:&quot;, e.message);</span>
<span class="c1">//     }</span>
<span class="c1">// })();</span>
</code></pre></div>

<h2 id="3-advanced-integration-examples">3. Advanced Integration Examples<a class="headerlink" href="#3-advanced-integration-examples" title="Permanent link">&para;</a></h2>
<h3 id="31-dfns-transaction-signing-backend-nodejs">3.1 DFNS Transaction Signing (Backend Node.js)<a class="headerlink" href="#31-dfns-transaction-signing-backend-nodejs" title="Permanent link">&para;</a></h3>
<p>This example demonstrates how to use the DFNS SDK to securely sign an EVM transaction on your backend using a DFNS wallet.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// backend/src/services/dfnsSigner.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DfnsApiClient</span><span class="p">,</span><span class="w"> </span><span class="nx">AsymmetricKeys</span><span class="p">,</span><span class="w"> </span><span class="nx">SignatureMechanism</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@dfns/sdk&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EvmTransaction</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@dfns/sdk/codegen/datamodel/EvmTransaction&#39;</span><span class="p">;</span><span class="w"> </span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ethers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">DFNS_API_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DFNS_API_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;https://api.dfns.io&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">DFNS_APP_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DFNS_APP_ID</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;YOUR_DFNS_APP_ID&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">DFNS_SIGNING_KEY_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DFNS_SIGNING_KEY_ID</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;sk-xxxxxxxxxxxxxxxxx&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">DFNS_PRIVATE_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DFNS_PRIVATE_KEY</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;YOUR_DFNS_PRIVATE_KEY_PEM&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Absolute path to PEM file or actual PEM string</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">dfnsClient</span><span class="o">:</span><span class="w"> </span><span class="kt">DfnsApiClient</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">initializeDfnsClient</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">dfnsClient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dfnsClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DfnsApiClient</span><span class="p">({</span>
<span class="w">            </span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">DFNS_API_URL</span><span class="p">,</span>
<span class="w">            </span><span class="nx">appId</span><span class="o">:</span><span class="w"> </span><span class="kt">DFNS_APP_ID</span><span class="p">,</span>
<span class="w">            </span><span class="nx">authMethod</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nx">AsymmetricKeys</span><span class="p">({</span>
<span class="w">                </span><span class="nx">privateKey</span><span class="o">:</span><span class="w"> </span><span class="kt">DFNS_PRIVATE_KEY</span><span class="p">,</span>
<span class="w">                </span><span class="nx">signingKeyId</span><span class="o">:</span><span class="w"> </span><span class="kt">DFNS_SIGNING_KEY_ID</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">dfnsClient</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">signEvmTransaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">walletId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumberish</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">gasLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumberish</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">initializeDfnsClient</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Prepare the raw EVM transaction payload</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rawTransaction</span><span class="o">:</span><span class="w"> </span><span class="kt">EvmTransaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">to</span><span class="p">,</span>
<span class="w">        </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumber.from</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">toHexString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// Convert to hex string</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">data</span><span class="p">,</span>
<span class="w">        </span><span class="nx">gasLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumber.from</span><span class="p">(</span><span class="nx">gasLimit</span><span class="p">).</span><span class="nx">toHexString</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumber.from</span><span class="p">(</span><span class="nx">chainId</span><span class="p">).</span><span class="nx">toHexString</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">nonce</span><span class="o">:</span><span class="w"> </span><span class="kt">ethers.BigNumber.from</span><span class="p">(</span><span class="nx">nonce</span><span class="p">).</span><span class="nx">toHexString</span><span class="p">(),</span>
<span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x0&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Or &quot;0x2&quot; for EIP-1559, then include maxFeePerGas, maxPriorityFeePerGas</span>
<span class="w">        </span><span class="c1">// For simplicity, omitting gasPrice / EIP-1559 fields for now</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">signRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">walletId</span><span class="o">:</span><span class="w"> </span><span class="kt">walletId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">chainId</span><span class="p">,</span><span class="w"> </span><span class="c1">// Format &quot;eip155:&lt;chain_id&gt;&quot; for DFNS if needed, otherwise just number</span>
<span class="w">            </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">rawTransaction</span><span class="p">),</span>
<span class="w">            </span><span class="nx">signatureMechanism</span><span class="o">:</span><span class="w"> </span><span class="kt">SignatureMechanism.JsonRpc</span><span class="p">,</span><span class="w"> </span><span class="c1">// Or Eip1559, etc.</span>
<span class="w">            </span><span class="nx">transactionType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;EvmTransaction&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">dfnsClient</span><span class="p">.</span><span class="nx">wallet</span><span class="p">.</span><span class="nx">signTransaction</span><span class="p">(</span><span class="nx">signRequest</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Transaction signed by DFNS:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">signedData</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">signedData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This is the fully signed hex string to broadcast</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;DFNS signing error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Example usage:</span>
<span class="c1">// (async () =&gt; {</span>
<span class="c1">//     try {</span>
<span class="c1">//         const dfnsWalletUuid = &quot;YOUR_DFNS_WALLET_UUID&quot;;</span>
<span class="c1">//         const targetChainId = &quot;11155111&quot;; // Sepolia</span>
<span class="c1">//         const recipientAddress = &quot;0x...&quot;;</span>
<span class="c1">//         const amountToSend = ethers.utils.parseEther(&quot;0.001&quot;);</span>
<span class="c1">//         const txData = &quot;0x&quot;; // Empty data for simple transfer</span>

<span class="c1">//         // You would typically get nonce and gasLimit from your RPC provider</span>
<span class="c1">//         const provider = new ethers.providers.JsonRpcProvider(&quot;https://sepolia.base.org&quot;);</span>
<span class="c1">//         const currentNonce = await provider.getTransactionCount(dfnsWalletUuid);</span>
<span class="c1">//         const gasLimit = 21000; // For simple ETH transfer</span>

<span class="c1">//         const signedTx = await signEvmTransaction(</span>
<span class="c1">//             dfnsWalletUuid,</span>
<span class="c1">//             recipientAddress,</span>
<span class="c1">//             amountToSend,</span>
<span class="c1">//             txData,</span>
<span class="c1">//             targetChainId,</span>
<span class="c1">//             currentNonce,</span>
<span class="c1">//             gasLimit</span>
<span class="c1">//         );</span>

<span class="c1">//         // Then broadcast the signed transaction</span>
<span class="c1">//         // const broadcastProvider = new ethers.providers.JsonRpcProvider(&quot;https://sepolia.base.org&quot;);</span>
<span class="c1">//         // const receipt = await broadcastProvider.sendTransaction(signedTx);</span>
<span class="c1">//         // await receipt.wait();</span>
<span class="c1">//         // console.log(&quot;Transaction broadcasted and confirmed:&quot;, receipt.hash);</span>
<span class="c1">//     } catch (e) {</span>
<span class="c1">//         console.error(&quot;DFNS Sample Demo Error:&quot;, e.message);</span>
<span class="c1">//     }</span>
<span class="c1">// })();</span>
</code></pre></div>

<h3 id="32-consuming-a-webhook-nodejs-with-express">3.2 Consuming a Webhook (Node.js with Express)<a class="headerlink" href="#32-consuming-a-webhook-nodejs-with-express" title="Permanent link">&para;</a></h3>
<p>This example provides a basic Node.js Express server to receive and process webhooks from the Gemforce platform.</p>
<p>```javascript
// backend/src/webhooks/webhookConsumer.ts
const express = require('express');
const bodyParser = require('body-parser');
const crypto = require('crypto');</p>
<p>const app = express();
const PORT = process.env.WEBHOOK_PORT || 3001; // Listen on a different port than main app
const WEBHOOK_SECRET = process.env.GEMFORCE_WEBHOOK_SECRET || "aStrongAndRandomSecretKeyForVerification"; // Must match config in Gemforce</p>
<p>app.use(bodyParser.json());</p>
<p>app.post('/gemforce-webhook', (req, res) =&gt; {
    console.log('Received HTTP POST to /gemforce-webhook');</p>
<div class="codehilite"><pre><span></span><code>// 1. Verify Signature (Crucial for security)
const signature = req.headers[&#39;x-gemforce-signature&#39;] as string; // Header sent by Gemforce
if (!signature) {
    console.warn(&#39;Webhook received without signature. Rejecting.&#39;);
    return res.status(401).send(&#39;Signature Missing&#39;);
}

try {
    const hmac = crypto.createHmac(&#39;sha256&#39;, WEBHOOK_SECRET);
    hmac.update(JSON.stringify(req.body));
    const calculatedSignature = hmac.digest(&#39;hex&#39;);

    if (signature !== calculatedSignature) {
        console.warn(&#39;Webhook signature verification failed. Possible tampering.&#39;);
        return res.status(403).send(&#39;Invalid Signature&#39;);
    }
    console.log(&#39;Webhook signature successfully verified.&#39;);

} catch (error) {
    console.error(&#39;Error during signature verification:&#39;, error);
    return res.status(500).send(&#39;Signature Verification Error&#39;);
}

// 2. Process the Payload
const eventType = req.body.event?.type;
const eventData = req.body.data;

if (!eventType || !eventData) {
    console.warn(&#39;Malformed webhook payload received. Missing event type or data.&#39;);
    return res.status(400).send(&#39;Malformed Payload&#39;);
}

console.log(`Processing event type: ${eventType}`);
// console.log(&#39;Event Data:&#39;, JSON.stringify(eventData, null, 2));

switch (eventType) {
    case &#39;user.created&#39;:
        console.log(`New User Created: ${eventData.object?.username} (ID: ${eventData.object?.objectId})`);
        // Add your logic: e.g., send welcome email, update user stats
        break;
    case &#39;marketplace.itemListed&#39;:
        console.log(`Marketplace Item Listed: NFT ${eventData.tokenId} at price ${ethers.utils.formatEther(eventData.price)} ETH`);
        // Add your logic: e.g., index item in a search database, notify subscribers
        break;
    case &#39;tradeDeal.statusUpdated&#39;:
        console.log(`Trade Deal ${eventData.tradeDealId} status changed to ${eventData.newStatus}`);
        // Update internal trade deal status, trigger further payment processing
        break;
    // Add more cases for other event types
    default:
        console.log(`Received unhandled event type: ${eventType}`);
        break;
}

// Acknowledge receipt
res.status(200).send(&#39;Webhook received and processed&#39;);
</code></pre></div>

<p>});</p>
<p>// Start the webhook listener
// app.listen(PORT, () =&gt; {
//     console.log(<code>Gemforce Webhook consumer listening on port ${PORT}</code>);
// });</p>
<p>export default app; // Export the app if used in a larger project</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../error-handling/" class="btn btn-neutral float-left" title="Error Handling"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../integration-patterns/" class="btn btn-neutral float-right" title="Integration Patterns">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../error-handling/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../integration-patterns/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
